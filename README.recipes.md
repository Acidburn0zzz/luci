<!--- AUTOGENERATED BY `./recipes.py test train` -->
# Repo documentation for [recipe\_engine](https://chromium.googlesource.com/infra/luci/recipes-py.git)
## Table of Contents

**[Recipe Modules](#Recipe-Modules)**
  * [archive](#recipe_modules-archive)
  * [assertions](#recipe_modules-assertions)
  * [buildbucket](#recipe_modules-buildbucket) &mdash; API for interacting with the buildbucket service.
  * [cipd](#recipe_modules-cipd) &mdash; API for interacting with CIPD.
  * [commit_position](#recipe_modules-commit_position)
  * [context](#recipe_modules-context) &mdash; The context module provides APIs for manipulating a few pieces of 'ambient' data that affect how steps are run.
  * [cq](#recipe_modules-cq)
  * [file](#recipe_modules-file) &mdash; File manipulation (read/write/delete/glob) methods.
  * [futures](#recipe_modules-futures)
  * [generator_script](#recipe_modules-generator_script) &mdash; A simplistic method for running steps generated by an external script.
  * [isolated](#recipe_modules-isolated)
  * [json](#recipe_modules-json) &mdash; Methods for producing and consuming JSON.
  * [led](#recipe_modules-led)
  * [path](#recipe_modules-path) &mdash; All functions related to manipulating paths in recipes.
  * [platform](#recipe_modules-platform) &mdash; Mockable system platform identity functions.
  * [properties](#recipe_modules-properties) &mdash; Provides access to the recipes input properties.
  * [python](#recipe_modules-python) &mdash; Provides methods for running python scripts correctly.
  * [random](#recipe_modules-random) &mdash; Allows randomness in recipes.
  * [raw_io](#recipe_modules-raw_io) &mdash; Provides objects for reading and writing raw data to and from steps.
  * [runtime](#recipe_modules-runtime)
  * [scheduler](#recipe_modules-scheduler) &mdash; API for interacting with the LUCI Scheduler service.
  * [service_account](#recipe_modules-service_account) &mdash; API for getting OAuth2 access tokens for LUCI tasks or private keys.
  * [source_manifest](#recipe_modules-source_manifest)
  * [step](#recipe_modules-step) &mdash; Step is the primary API for running steps (external programs, scripts, etc.
  * [swarming](#recipe_modules-swarming)
  * [tempfile](#recipe_modules-tempfile) &mdash; Simplistic temporary directory manager (deprecated).
  * [time](#recipe_modules-time) &mdash; Allows mockable access to the current time.
  * [tricium](#recipe_modules-tricium) &mdash; API for Tricium analyzers to use.
  * [url](#recipe_modules-url) &mdash; Methods for interacting with HTTP(s) URLs.
  * [uuid](#recipe_modules-uuid) &mdash; Allows test-repeatable access to a random UUID.

**[Recipes](#Recipes)**
  * [archive:examples/full](#recipes-archive_examples_full)
  * [assertions:tests/assert-raises](#recipes-assertions_tests_assert-raises)
  * [assertions:tests/assertions](#recipes-assertions_tests_assertions)
  * [assertions:tests/attribute_error](#recipes-assertions_tests_attribute_error)
  * [assertions:tests/long_message](#recipes-assertions_tests_long_message)
  * [assertions:tests/max_diff](#recipes-assertions_tests_max_diff)
  * [buildbucket:examples/full](#recipes-buildbucket_examples_full) &mdash; This file is a recipe demonstrating the buildbucket recipe module.
  * [buildbucket:run/multi](#recipes-buildbucket_run_multi) &mdash; Launches multiple builds at the same revision.
  * [buildbucket:tests/build](#recipes-buildbucket_tests_build)
  * [buildbucket:tests/collect](#recipes-buildbucket_tests_collect)
  * [buildbucket:tests/get](#recipes-buildbucket_tests_get)
  * [buildbucket:tests/put](#recipes-buildbucket_tests_put)
  * [buildbucket:tests/schedule](#recipes-buildbucket_tests_schedule)
  * [buildbucket:tests/search](#recipes-buildbucket_tests_search)
  * [cipd:examples/full](#recipes-cipd_examples_full)
  * [commit_position:examples/full](#recipes-commit_position_examples_full)
  * [context:examples/full](#recipes-context_examples_full)
  * [context:tests/cwd](#recipes-context_tests_cwd)
  * [context:tests/env](#recipes-context_tests_env)
  * [context:tests/infra_step](#recipes-context_tests_infra_step)
  * [cq:examples/ordered_cls](#recipes-cq_examples_ordered_cls)
  * [cq:examples/trigger_child_builds](#recipes-cq_examples_trigger_child_builds)
  * [cq:tests/experimental](#recipes-cq_tests_experimental)
  * [cq:tests/triggered_build_ids](#recipes-cq_tests_triggered_build_ids)
  * [cq:tests/type_of_run](#recipes-cq_tests_type_of_run)
  * [engine_tests/bad_subprocess](#recipes-engine_tests_bad_subprocess) &mdash; Tests that daemons that hang on to STDOUT can't cause the engine to hang.
  * [engine_tests/comprehensive_ui](#recipes-engine_tests_comprehensive_ui) &mdash; A fast-running recipe which comprehensively covers all StepPresentation features available in the recipe engine.
  * [engine_tests/config_operations](#recipes-engine_tests_config_operations) &mdash; Tests that recipes can modify configuration options in various ways.
  * [engine_tests/expect_exception](#recipes-engine_tests_expect_exception) &mdash; Tests that step_data can accept multiple specs at once.
  * [engine_tests/failure_results](#recipes-engine_tests_failure_results) &mdash; Tests that run_steps is handling recipe failures correctly.
  * [engine_tests/functools_partial](#recipes-engine_tests_functools_partial) &mdash; Engine shouldn't explode when step_test_data gets functools.
  * [engine_tests/incorrect_recipe_result](#recipes-engine_tests_incorrect_recipe_result) &mdash; Tests that engine.
  * [engine_tests/missing_start_dir](#recipes-engine_tests_missing_start_dir) &mdash; Tests that deleting the current working directory doesn't immediately fail.
  * [engine_tests/module_injection_site](#recipes-engine_tests_module_injection_site) &mdash; This test serves to demonstrate that the ModuleInjectionSite object on recipe modules (i.
  * [engine_tests/multi_test_data](#recipes-engine_tests_multi_test_data) &mdash; Tests that step_data can accept multiple specs at once.
  * [engine_tests/multiple_placeholders](#recipes-engine_tests_multiple_placeholders) &mdash; Tests error checking around multiple placeholders in a single step.
  * [engine_tests/nonexistent_command](#recipes-engine_tests_nonexistent_command)
  * [engine_tests/placeholder_exception](#recipes-engine_tests_placeholder_exception) &mdash; Tests that placeholders can't wreck the world by exhausting the step stack.
  * [engine_tests/proto_properties](#recipes-engine_tests_proto_properties)
  * [engine_tests/recipe_paths](#recipes-engine_tests_recipe_paths) &mdash; Tests that recipes have access to names, resources and their repo.
  * [engine_tests/sort_properties](#recipes-engine_tests_sort_properties) &mdash; Tests that step presentation properties can be ordered.
  * [engine_tests/undeclared_method](#recipes-engine_tests_undeclared_method)
  * [engine_tests/unicode](#recipes-engine_tests_unicode)
  * [engine_tests/whitelist_steps](#recipes-engine_tests_whitelist_steps) &mdash; Tests that step_data can accept multiple specs at once.
  * [file:examples/copy](#recipes-file_examples_copy)
  * [file:examples/copytree](#recipes-file_examples_copytree)
  * [file:examples/error](#recipes-file_examples_error)
  * [file:examples/flatten_single_directories](#recipes-file_examples_flatten_single_directories)
  * [file:examples/glob](#recipes-file_examples_glob)
  * [file:examples/handle_json_file](#recipes-file_examples_handle_json_file)
  * [file:examples/listdir](#recipes-file_examples_listdir)
  * [file:examples/raw_copy](#recipes-file_examples_raw_copy)
  * [file:examples/symlink](#recipes-file_examples_symlink)
  * [file:examples/truncate](#recipes-file_examples_truncate)
  * [futures:examples/background_helper](#recipes-futures_examples_background_helper)
  * [futures:examples/extreme_namespaces](#recipes-futures_examples_extreme_namespaces)
  * [futures:examples/fan_out_in](#recipes-futures_examples_fan_out_in)
  * [futures:examples/lazy_fan_out_in](#recipes-futures_examples_lazy_fan_out_in)
  * [futures:examples/lazy_fan_out_in_early_abort](#recipes-futures_examples_lazy_fan_out_in_early_abort)
  * [futures:examples/result](#recipes-futures_examples_result)
  * [generator_script:examples/full](#recipes-generator_script_examples_full)
  * [isolated:examples/full](#recipes-isolated_examples_full)
  * [json:examples/full](#recipes-json_examples_full)
  * [json:tests/add_json_log](#recipes-json_tests_add_json_log)
  * [led:tests/full](#recipes-led_tests_full)
  * [path:examples/full](#recipes-path_examples_full)
  * [platform:examples/full](#recipes-platform_examples_full)
  * [properties:examples/full](#recipes-properties_examples_full)
  * [python:examples/full](#recipes-python_examples_full) &mdash; Launches the repo bundler.
  * [python:tests/infra_failing_step](#recipes-python_tests_infra_failing_step) &mdash; Tests for api.
  * [random:tests/full](#recipes-random_tests_full)
  * [raw_io:examples/full](#recipes-raw_io_examples_full)
  * [runtime:tests/full](#recipes-runtime_tests_full)
  * [scheduler:examples/emit_triggers](#recipes-scheduler_examples_emit_triggers) &mdash; This file is a recipe demonstrating emitting triggers to LUCI Scheduler.
  * [scheduler:examples/host](#recipes-scheduler_examples_host) &mdash; This file is a recipe demonstrating reading/mocking scheduler host.
  * [scheduler:examples/triggers](#recipes-scheduler_examples_triggers) &mdash; This file is a recipe demonstrating reading triggers of the current build.
  * [service_account:examples/full](#recipes-service_account_examples_full)
  * [source_manifest:examples/simple](#recipes-source_manifest_examples_simple)
  * [step:examples/full](#recipes-step_examples_full)
  * [step:tests/active_result](#recipes-step_tests_active_result)
  * [step:tests/defer](#recipes-step_tests_defer)
  * [step:tests/inject_paths](#recipes-step_tests_inject_paths)
  * [step:tests/nested](#recipes-step_tests_nested)
  * [step:tests/stdio](#recipes-step_tests_stdio)
  * [step:tests/step_call_args](#recipes-step_tests_step_call_args)
  * [step:tests/subannotations](#recipes-step_tests_subannotations)
  * [step:tests/timeout](#recipes-step_tests_timeout)
  * [step:tests/trigger](#recipes-step_tests_trigger)
  * [swarming:examples/full](#recipes-swarming_examples_full)
  * [tempfile:examples/full](#recipes-tempfile_examples_full)
  * [time:examples/full](#recipes-time_examples_full)
  * [tricium:examples/full](#recipes-tricium_examples_full)
  * [url:examples/full](#recipes-url_examples_full)
  * [url:tests/join](#recipes-url_tests_join)
  * [url:tests/validate_url](#recipes-url_tests_validate_url)
  * [uuid:examples/full](#recipes-uuid_examples_full)
## Recipe Modules

### *recipe_modules* / [archive](/recipe_modules/archive)

[DEPS](/recipe_modules/archive/__init__.py#5): [json](#recipe_modules-json), [path](#recipe_modules-path), [platform](#recipe_modules-platform), [python](#recipe_modules-python), [step](#recipe_modules-step)

#### **class [ArchiveApi](/recipe_modules/archive/api.py#8)([RecipeApi](/recipe_engine/recipe_api.py#850)):**

Provides steps to manipulate archive files (tar, zip, etc.).

&mdash; **def [extract](/recipe_modules/archive/api.py#42)(self, step_name, archive_file, output, mode='safe', include_files=()):**

Step to uncompress |archive_file| into |output| directory.

Archive will be unpacked to |output| so that root of an archive is in
|output|, i.e. archive.tar/file.txt will become |output|/file.txt.

Step will FAIL if |output| already exists.

Args:

  * step_name (str): display name of a step.
  * archive_file (Path): path to an archive file to uncompress, MUST exist.
  * output (Path): path to a directory to unpack to, MUST NOT exist.
  * mode (str): Must be either 'safe' or 'unsafe'. In safe mode, if the
    archive attempts to extract files which would escape the extraction
    `output` location, the extraction will fail (raise StepException)
    which contains a member `StepException.archive_skipped_files` (all
    other files will be extracted normally). If 'unsafe', then tarfiles
    containing paths escaping `output` will be extracted as-is.
  * include_files (List[str]) - A list of globs matching files within the
    archive. Any files not matching any of these globs will be skipped.
    If omitted, all files are extracted (the default). Globs are matched
    with the `fnmatch` module. If a file "filename" in the archive exists,
    include_files with "file*" will match it. All paths for the matcher
    are converted to posix style (forward slash).

&mdash; **def [package](/recipe_modules/archive/api.py#13)(self, root):**

Returns Package object that can be used to compress a set of files.

Usage:

    # Archive root/file and root/directory/**
    (api.archive.package(root).
        with_file(root.join('file')).
        with_dir(root.join('directory')).
        archive('archive step', output, 'tbz'))

    # Archive root/**
    zip_path = (
      api.archive.package(root).
      archive('archive step', api.path['start_dir'].join('output.zip'))
    )

Args:

  * root: a directory that would become root of a package, all files added
      to an archive must be Paths which are under this directory. If no
      files or directories are added with 'with_file' or 'with_dir', the
      entire root directory is packaged.

Returns:
  Package object.
### *recipe_modules* / [assertions](/recipe_modules/assertions)

#### **class [AssertionsApi](/recipe_modules/assertions/api.py#56)([RecipeApi](/recipe_engine/recipe_api.py#850)):**

Provides access to the assertion methods of the python unittest module.

Asserting non-step aspects of code (return values, non-step side effects) is
expressed more naturally by making assertions within the RunSteps function of
the test recipe. This api provides access to the assertion methods of
unittest.TestCase to be used within test recipes.

All non-deprecated assertion methods of unittest.TestCase can be used.

An enhancement to the assertion methods is that if a custom msg is used,
values for the non-msg arguments can be substituted into the message using
named substitution with the format method of strings.
e.g. self.AssertEqual(0, 1, '{first} should be {second}') will raise an
AssertionError with the message: '0 should be 1'.

The attributes longMessage and maxDiff are supported and have the same
behavior as the unittest module.

Example (.../recipe_modules/my_module/tests/foo.py):
DEPS = [
    'my_module',
    'recipe_engine/assertions',
    'recipe_engine/properties',
    'recipe_engine/runtime',
]

def RunSteps(api):
  # Behavior of foo depends on whether build is experimental
  value = api.my_module.foo()
  expected_value = api.properties.get('expected_value')
  api.assertions.assertEqual(value, expected_value)

def GenTests(api):
  yield (
      api.test('basic')
      + api.properties(expected_value='normal value')
  )

  yield (
      api.test('experimental')
      + api.properties(expected_value='experimental value')
      + api.properties(is_luci=True, is_experimental=True)
 )
### *recipe_modules* / [buildbucket](/recipe_modules/buildbucket)

[DEPS](/recipe_modules/buildbucket/__init__.py#5): [json](#recipe_modules-json), [path](#recipe_modules-path), [platform](#recipe_modules-platform), [properties](#recipe_modules-properties), [raw\_io](#recipe_modules-raw_io), [runtime](#recipe_modules-runtime), [step](#recipe_modules-step), [uuid](#recipe_modules-uuid)

API for interacting with the buildbucket service.

Requires `buildbucket` command in `$PATH`:
https://godoc.org/go.chromium.org/luci/buildbucket/client/cmd/buildbucket

`url_title_fn` parameter used in this module is a function that accepts a
`build_pb2.Build` and returns a link title.
If it returns `None`, the link is not reported. Default link title is build id.

#### **class [BuildbucketApi](/recipe_modules/buildbucket/api.py#29)([RecipeApi](/recipe_engine/recipe_api.py#850)):**

A module for interacting with buildbucket.

&emsp; **@property**<br>&mdash; **def [bucket\_v1](/recipe_modules/buildbucket/api.py#857)(self):**

Returns bucket name in v1 format.

Mostly useful for scheduling new builds using V1 API.

&emsp; **@property**<br>&mdash; **def [build](/recipe_modules/buildbucket/api.py#115)(self):**

Returns current build as a `buildbucket.v2.Build` protobuf message.

For value format, see `Build` message in
[build.proto](https://chromium.googlesource.com/infra/luci/luci-go/+/master/buildbucket/proto/build.proto).

DO NOT MODIFY the returned value.
Do not implement conditional logic on returned tags; they are for indexing.
Use returned `build.input` instead.

Pure Buildbot support: to simplify transition to buildbucket, returns a
message even if the current build is not a buildbucket build. Provides as
much information as possible. Some fields may be left empty, violating
the rules described in the .proto files.
If the current build is not a buildbucket build, returned `build.id` is 0.

&emsp; **@property**<br>&mdash; **def [build\_id](/recipe_modules/buildbucket/api.py#873)(self):**

DEPRECATED, use build.id instead.

&emsp; **@property**<br>&mdash; **def [build\_input](/recipe_modules/buildbucket/api.py#878)(self):**

DEPRECATED, use build.input instead.

&mdash; **def [build\_url](/recipe_modules/buildbucket/api.py#139)(self, host=None, build_id=None):**

Returns url to a build. Defaults to current build.

&emsp; **@property**<br>&mdash; **def [builder\_cache\_path](/recipe_modules/buildbucket/api.py#245)(self):**

Path to the builder cache directory.

Such directory can be used to cache builder-specific data.
It remains on the bot from build to build.
See "Builder cache" in
https://chromium.googlesource.com/infra/luci/luci-go/+/master/buildbucket/proto/project_config.proto

&emsp; **@property**<br>&mdash; **def [builder\_id](/recipe_modules/buildbucket/api.py#883)(self):**

Deprecated. Use build.builder instead.

&emsp; **@property**<br>&mdash; **def [builder\_name](/recipe_modules/buildbucket/api.py#134)(self):**

Returns builder name. Shortcut for `.build.builder.builder`.

&mdash; **def [cancel\_build](/recipe_modules/buildbucket/api.py#619)(self, build_id, \*\*kwargs):**

&mdash; **def [collect\_build](/recipe_modules/buildbucket/api.py#682)(self, build_id, \*\*kwargs):**

Shorthand for `collect_builds` below, but for a single build only.

Args:
* build_id: Integer ID of the build to wait for.

Returns:
  [Build](https://chromium.googlesource.com/infra/luci/luci-go/+/master/buildbucket/proto/build.proto).
  for the ended build.

&mdash; **def [collect\_builds](/recipe_modules/buildbucket/api.py#695)(self, build_ids, interval=None, timeout=None, step_name=None, raise_if_unsuccessful=False, url_title_fn=None, mirror_status=False):**

Waits for a set of builds to end and returns their details.

Args:
* `build_ids`: List of build IDs to wait for.
* `interval`: Delay (in secs) between requests while waiting for build to end.
  Defaults to 1m.
* `timeout`: Maximum time to wait for builds to end. Defaults to 1h.
* `step_name`: Custom name for the generated step.
* `raise_if_unsuccessful`: if any build being collected did not succeed, raise
  an exception.
* `url_title_fn`: generates build URL title. See module docstring.
* `mirror_status`: mark the step as failed/infra-failed if any of the builds
  did not succeed. Ignored if raise_if_unsuccessful is True.

Returns:
  A map from integer build IDs to the corresponding
  [Build](https://chromium.googlesource.com/infra/luci/luci-go/+/master/buildbucket/proto/build.proto)
  for all specified builds.

&mdash; **def [get](/recipe_modules/buildbucket/api.py#661)(self, build_id, url_title_fn=None, step_name=None):**

Gets a build.

Args:
*   `build_id`: a buildbucket build ID.
*   `url_title_fn`: generates build URL title. See module docstring.
*   `step_name`: name for this step.

Returns:
  A build_pb2.Build.

&mdash; **def [get\_build](/recipe_modules/buildbucket/api.py#678)(self, build_id, \*\*kwargs):**

DEPRECATED. Use get().

&mdash; **def [get\_multi](/recipe_modules/buildbucket/api.py#622)(self, build_ids, url_title_fn=None, step_name=None):**

Gets multiple builds.

Args:
*   `build_ids`: a list of build IDs.
*   `url_title_fn`: generates build URL title. See module docstring.
*   `step_name`: name for this step.

Returns:
  A dict {build_id: build_pb2.Build}.

&emsp; **@property**<br>&mdash; **def [gitiles\_commit](/recipe_modules/buildbucket/api.py#144)(self):**

Returns input gitiles commit. Shortcut for `.build.input.gitiles_commit`.

For value format, see
[`GitilesCommit` message](https://chromium.googlesource.com/infra/luci/luci-go/+/master/buildbucket/proto/build.proto).

Never returns None, but sub-fields may be empty.

&emsp; **@host.setter**<br>&mdash; **def [host](/recipe_modules/buildbucket/api.py#93)(self, value):**

&mdash; **def [is\_critical](/recipe_modules/buildbucket/api.py#155)(self, build=None):**

Returns True if the build is critical. Build defaults to the current one.
    

&emsp; **@property**<br>&mdash; **def [properties](/recipe_modules/buildbucket/api.py#868)(self):**

DEPRECATED, use build attribute instead.

&mdash; **def [put](/recipe_modules/buildbucket/api.py#523)(self, builds, \*\*kwargs):**

Puts a batch of builds.

DEPRECATED. Use `schedule()` instead.

Args:
* builds (list): A list of dicts, where keys are:
  * 'bucket': (required) name of the bucket for the request.
  * 'parameters' (dict): (required) arbitrary json-able parameters that a
     build system would be able to interpret.
  * 'experimental': (optional) a bool indicating whether build is
     experimental. If not provided, the value will be determined by whether
     the currently running build is experimental.
  * 'tags': (optional) a dict(str->str) of tags for the build. These will
     be added to those generated by this method and override them if
     appropriate. If you need to remove a tag set by default, set its value
     to `None` (for example, `tags={'buildset': None}` will ensure build is
     triggered without `buildset` tag).

Returns:
  A step that as its `.stdout` property contains the response object as
  returned by buildbucket.

&mdash; **def [run](/recipe_modules/buildbucket/api.py#276)(self, schedule_build_requests, collect_interval=None, timeout=None, url_title_fn=None, step_name=None, raise_if_unsuccessful=False):**

Runs builds and returns results.

A shortcut for schedule() and collect_builds().
See their docstrings.

Returns:
  A list of completed
  [Builds](https://chromium.googlesource.com/infra/luci/luci-go/+/master/buildbucket/proto/build.proto)
  in the same order as schedule_build_requests.

&mdash; **def [schedule](/recipe_modules/buildbucket/api.py#447)(self, schedule_build_requests, url_title_fn=None, step_name=None):**

Schedules a batch of builds.

Example:
```python
    req = api.buildbucket.schedule_request(builder='linux')
    api.buildbucket.schedule([req])
```

Hint: when scheduling builds for CQ, let CQ know about them:
```python
    api.cq.record_triggered_builds(*api.buildbucket.schedule([req1, req2]))
```

Args:
*   schedule_build_requests: a list of `buildbucket.v2.ScheduleBuildRequest`
    protobuf messages. Create one by calling `schedule_request` method.
*   url_title_fn: generates a build URL title. See module docstring.
*   step_name: name for this step.

Returns:
  A list of
  [`Build`](https://chromium.googlesource.com/infra/luci/luci-go/+/master/buildbucket/proto/build.proto)
  messages in the same order as requests.

Raises:
  `InfraFailure` if any of the requests fail.

&mdash; **def [schedule\_request](/recipe_modules/buildbucket/api.py#304)(self, builder, project=None, bucket=None, properties=None, experimental=None, gitiles_commit=None, gerrit_changes=None, tags=None, inherit_buildsets=True, dimensions=None, priority=None, critical=None, exe_cipd_version=None):**

Creates a new `ScheduleBuildRequest` message with reasonable defaults.

This is a convenient function to create a `ScheduleBuildRequest` message.

Among args, messages can be passed as dicts of the same structure.

Example:

    request = api.buildbucket.schedule_request(
        builder='linux',
        tags=api.buildbucket.tags(a='b'),
    )
    build = api.buildbucket.schedule([request])[0]

Args:
* builder (str): name of the destination builder.
* project (str): project containing the destinaiton builder.
  Defaults to the project of the current build.
* bucket (str): bucket containing the destination builder.
  Defaults to the bucket of the current build.
* properties (dict): input properties for the new build.
* experimental: whether the build is allowed to affect prod.
  If not None, must be `common_pb2.Trinary` or bool.
  Defaults to the value of the current build.
  Read more about
  [`experimental` field](https://cs.chromium.org/chromium/infra/go/src/go.chromium.org/luci/buildbucket/proto/build.proto?q="bool experimental").
* gitiles_commit (common_pb2.GitilesCommit): input commit.
  Defaults to the input commit of the current build.
  Read more about
  [`gitiles_commit`](https://cs.chromium.org/chromium/infra/go/src/go.chromium.org/luci/buildbucket/proto/build.proto?q=Input.gitiles_commit).
* gerrit_changes (list or common_pb2.GerritChange): list of input CLs.
  Defaults to gerrit changes of the current build.
  Read more about
  [`gerrit_changes`](https://cs.chromium.org/chromium/infra/go/src/go.chromium.org/luci/buildbucket/proto/build.proto?q=Input.gerrit_changes).
* tags (list or common_pb2.StringPair): tags for the new build.
* inherit_buildsets (bool): if `True` (default), the returned request will
  include buildset tags from the current build.
* dimensions (list of common_pb2.RequestedDimension): override dimensions
  defined on the server.
* priority (int): Swarming task priority.
  The lower the more important. Valid values are `[20..255]`.
  Defaults to the value of the current build.
* critical: whether the build status should not be used to assess
  correctness of the commit/CL.
  Defaults to .build.critical.
  See also Build.critical in
  https://chromium.googlesource.com/infra/luci/luci-go/+/master/buildbucket/proto/build.proto
* exe_cipd_version: CIPD version of the LUCI Executable (e.g. recipe) to use
  instead of the server-configured one.

&mdash; **def [search](/recipe_modules/buildbucket/api.py#558)(self, predicate, limit=None, url_title_fn=None, step_name=None):**

Searches for builds.

Example: find all builds of the current CL.

```python
from PB.go.chromium.org.luci.buildbucket.proto import rpc as rpc_pb2

related_builds = api.buildbucket.search(rpc_pb2.BuildPredicate(
  gerrit_changes=list(api.buildbucket.build.input.gerrit_changes),
))
```

Args:
*   predicate: a `rpc_pb2.BuildPredicate` object or a list thereof.
    If a list, the predicates are connected with logical OR.
*   limit: max number of builds to return. Defaults to 1000.
*   url_title_fn: generates a build URL title. See module docstring.

Returns:
  A list of builds ordered newest-to-oldest.

&mdash; **def [set\_buildbucket\_host](/recipe_modules/buildbucket/api.py#97)(self, host):**

DEPRECATED. Use host property.

&mdash; **def [set\_output\_gitiles\_commit](/recipe_modules/buildbucket/api.py#198)(self, gitiles_commit):**

Sets `buildbucket.v2.Build.output.gitiles_commit` field.

This will tell other systems, consuming the build, what version of the code
was actually used in this build and what is the position of this build
relative to other builds of the same builder.

Args:
* gitiles_commit(buildbucket.common_pb2.GitilesCommit): the commit that was
  actually checked out. Must have host, project and id.
  ID must match r'^[0-9a-f]{40}$' (git revision).
  If position is present, the build can be ordered along commits.
  Position requires ref.
  Ref, if not empty, must start with `refs/`.

Can be called at most once per build.

&mdash; **def [tags](/recipe_modules/buildbucket/api.py#241)(self, \*\*tags):**

Alias for tags in util.py. See doc there.

&emsp; **@property**<br>&mdash; **def [tags\_for\_child\_build](/recipe_modules/buildbucket/api.py#161)(self):**

A dict of tags (key -> value) derived from current (parent) build for a
child build.

&mdash; **def [use\_service\_account\_key](/recipe_modules/buildbucket/api.py#101)(self, key_path):**

Tells this module to start using given service account key for auth.

Otherwise the module is using the default account (when running on LUCI or
locally), or no auth at all (when running on Buildbot).

Exists mostly to support Buildbot environment. Recipe for LUCI environment
should not use this.

Args:
*  key_path (str): a path to JSON file with service account credentials.
### *recipe_modules* / [cipd](/recipe_modules/cipd)

[DEPS](/recipe_modules/cipd/__init__.py#5): [json](#recipe_modules-json), [path](#recipe_modules-path), [platform](#recipe_modules-platform), [properties](#recipe_modules-properties), [python](#recipe_modules-python), [raw\_io](#recipe_modules-raw_io), [service\_account](#recipe_modules-service_account), [step](#recipe_modules-step)

API for interacting with CIPD.

Depends on 'cipd' binary available in PATH:
https://godoc.org/go.chromium.org/luci/cipd/client/cmd/cipd

#### **class [CIPDApi](/recipe_modules/cipd/api.py#199)([RecipeApi](/recipe_engine/recipe_api.py#850)):**

CIPDApi provides basic support for CIPD.

This assumes that `cipd` (or `cipd.exe` or `cipd.bat` on windows) has been
installed somewhere in $PATH.

&mdash; **def [acl\_check](/recipe_modules/cipd/api.py#284)(self, pkg_path, reader=True, writer=False, owner=False):**

Checks whether the caller has a given roles in a package.

Args:
  * pkg_path (str) - The package subpath.
  * reader (bool) - Check for READER role.
  * writer (bool) - Check for WRITER role.
  * owner (bool) - Check for OWNER role.

Returns True if the caller has given roles, False otherwise.

&mdash; **def [build](/recipe_modules/cipd/api.py#376)(self, input_dir, output_package, package_name, compression_level=None, install_mode=None, preserve_mtime=False, preserve_writable=False):**

Builds, but does not upload, a cipd package from a directory.

Args:
  * input_dir (Path) - The directory to build the package from.
  * output_package (Path) - The file to write the package to.
  * package_name (str) - The name of the cipd package as it would appear
    when uploaded to the cipd package server.
  * compression_level (None|[0-9]) - Deflate compression level. If None,
    defaults to 5 (0 - disable, 1 - best speed, 9 - best compression).
  * install_mode (None|'copy'|'symlink') - The mechanism that the cipd
    client should use when installing this package. If None, defaults to the
    platform default ('copy' on windows, 'symlink' on everything else).
  * preserve_mtime (bool) - Preserve file's modification time.
  * preserve_writable (bool) - Preserve file's writable permission bit.

Returns the CIPDApi.Pin instance.

&mdash; **def [build\_from\_pkg](/recipe_modules/cipd/api.py#355)(self, pkg_def, output_package, compression_level=None):**

Builds a package based on a PackageDefinition object.

Args:
  * pkg_def (PackageDefinition) - The description of the package we want to
    create.
  * output_package (Path) - The file to write the package to.
  * compression_level (None|[0-9]) - Deflate compression level. If None,
    defaults to 5 (0 - disable, 1 - best speed, 9 - best compression).

Returns the CIPDApi.Pin instance.

&mdash; **def [build\_from\_yaml](/recipe_modules/cipd/api.py#332)(self, pkg_def, output_package, pkg_vars=None, compression_level=None):**

Builds a package based on on-disk YAML package definition file.

Args:
  * pkg_def (Path) - The path to the yaml file.
  * output_package (Path) - The file to write the package to.
  * pkg_vars (dict[str]str) - A map of var name -> value to use for vars
    referenced in package definition file.
  * compression_level (None|[0-9]) - Deflate compression level. If None,
    defaults to 5 (0 - disable, 1 - best speed, 9 - best compression).

Returns the CIPDApi.Pin instance.

&mdash; **def [create\_from\_pkg](/recipe_modules/cipd/api.py#513)(self, pkg_def, refs=None, tags=None, compression_level=None):**

Builds and uploads a package based on a PackageDefinition object.

This builds and uploads the package in one step.

Args:
  * pkg_def (PackageDefinition) - The description of the package we want to
    create.
  * refs (list[str]) - A list of ref names to set for the package instance.
  * tags (dict[str]str) - A map of tag name -> value to set for the
    package instance.
  * compression_level (None|[0-9]) - Deflate compression level. If None,
    defaults to 5 (0 - disable, 1 - best speed, 9 - best compression).

Returns the CIPDApi.Pin instance.

&mdash; **def [create\_from\_yaml](/recipe_modules/cipd/api.py#489)(self, pkg_def, refs=None, tags=None, pkg_vars=None, compression_level=None):**

Builds and uploads a package based on on-disk YAML package definition
file.

This builds and uploads the package in one step.

Args:
  * pkg_def (Path) - The path to the yaml file.
  * refs (list[str]) - A list of ref names to set for the package instance.
  * tags (dict[str]str) - A map of tag name -> value to set for the
    package instance.
  * pkg_vars (dict[str]str) - A map of var name -> value to use for vars
    referenced in package definition file.
  * compression_level (None|[0-9]) - Deflate compression level. If None,
    defaults to 5 (0 - disable, 1 - best speed, 9 - best compression).

Returns the CIPDApi.Pin instance.

&mdash; **def [describe](/recipe_modules/cipd/api.py#636)(self, package_name, version, test_data_refs=None, test_data_tags=None):**

Returns information about a pacakge instance given its version:
who uploaded the instance and when and a list of attached tags.

Args:
  * package_name (str) - The name of the cipd package.
  * version (str) - The package version to point the ref to.
  * test_data_refs (seq[str]) - The list of refs for this call to return
    by default when in test mode.
  * test_data_tags (seq[str]) - The list of tags (in 'name:val' form) for
    this call to return by default when in test mode.

Returns the CIPDApi.Description instance describing the package.

&mdash; **def [ensure](/recipe_modules/cipd/api.py#535)(self, root, ensure_file):**

Ensures that packages are installed in a given root dir.

Args:
  * root (Path) - Path to installation site root directory.
  * ensure_file (EnsureFile) - List of packages to install.

Returns the map of subdirectories to CIPDApi.Pin instances.

&emsp; **@property**<br>&mdash; **def [executable](/recipe_modules/cipd/api.py#269)(self):**

&mdash; **def [pkg\_deploy](/recipe_modules/cipd/api.py#701)(self, root, package_file):**

Deploys the specified package to root.

ADVANCED METHOD: You shouldn't need this unless you're doing advanced things
with CIPD. Typically you should use the `ensure` method here to
fetch+install packages to the disk.

Args:
  * package_file (Path) - Path to a package file to install.
  * root (Path) - Path to a CIPD root.

Returns a Pin for the deployed package.

&mdash; **def [pkg\_fetch](/recipe_modules/cipd/api.py#669)(self, destination, package_name, version):**

Downloads the specified package to destination.

ADVANCED METHOD: You shouldn't need this unless you're doing advanced things
with CIPD. Typically you should use the `ensure` method here to
fetch+install packages to the disk.

Args:
  * destination (Path) - Path to a file location which will be (over)written
    with the package file contents.
  * package_name (str) - The package name (or pattern with e.g.
    ${platform})
  * version (str) - The CIPD version to fetch

Returns a Pin for the downloaded package.

&mdash; **def [register](/recipe_modules/cipd/api.py#441)(self, package_name, package_path, refs=(), tags=None):**

Uploads and registers package instance in the package repository.

Args:
  * package_name (str) - The name of the cipd package.
  * package_path (Path) - The path to package instance file.
  * refs (seq[str]) - A list of ref names to set for the package instance.
  * tags (dict[str]basestring) - A map of tag name -> value to set for the package
                          instance.

Returns:
  The CIPDApi.Pin instance.

&mdash; **def [search](/recipe_modules/cipd/api.py#611)(self, package_name, tag):**

Searches for package instances by tag, optionally constrained by package
name.

Args:
  * package_name (str) - The name of the cipd package.
  * tag (str) - The cipd package tag.

Returns the list of CIPDApi.Pin instances.

&mdash; **def [set\_ref](/recipe_modules/cipd/api.py#586)(self, package_name, version, refs):**

Moves a ref to point to a given version.

Args:
  * package_name (str) - The name of the cipd package.
  * version (str) - The package version to point the ref to.
  * refs (list[str]) - A list of ref names to set for the package instance.

Returns the CIPDApi.Pin instance.

&emsp; **@contextlib.contextmanager**<br>&mdash; **def [set\_service\_account](/recipe_modules/cipd/api.py#247)(self, service_account):**

Temporarily sets the service account used for authentication to CIPD.

Implemented as a context manager to avoid one part of a recipe from
overwriting another's specified service account.

Args:
  * service_account(service_account.api.ServiceAccount): Service account to
      use for authentication.

&mdash; **def [set\_tag](/recipe_modules/cipd/api.py#559)(self, package_name, version, tags):**

Tags package of a specific version.

Args:
  * package_name (str) - The name of the cipd package.
  * version (str) - The package version to resolve. Could also be itself a
    tag or ref.
  * tags (dict[str]str) - A map of tag name -> value to set for the
    package instance.

Returns the CIPDApi.Pin instance.
### *recipe_modules* / [commit\_position](/recipe_modules/commit_position)

#### **class [CommitPositionApi](/recipe_modules/commit_position/api.py#10)([RecipeApi](/recipe_engine/recipe_api.py#850)):**

Recipe module providing commit position parsing and formatting.

&emsp; **@classmethod**<br>&mdash; **def [format](/recipe_modules/commit_position/api.py#26)(cls, ref, revision_number):**

Returns a commit position string.

ref must start with 'refs/'.

&emsp; **@classmethod**<br>&mdash; **def [parse](/recipe_modules/commit_position/api.py#16)(cls, value):**

Returns (ref, revision_number) tuple.
### *recipe_modules* / [context](/recipe_modules/context)

[DEPS](/recipe_modules/context/__init__.py#5): [path](#recipe_modules-path)

The context module provides APIs for manipulating a few pieces of 'ambient'
data that affect how steps are run.

The pieces of information which can be modified are:
  * cwd - The current working directory.
  * env - The environment variables.
  * infra_step - Whether or not failures should be treated as infrastructure
    failures vs. normal failures.

The values here are all scoped using Python's `with` statement; there's no
mechanism to make an open-ended adjustment to these values (i.e. there's no way
to change the cwd permanently for a recipe, except by surrounding the entire
recipe with a with statement). This is done to avoid the surprises that
typically arise with things like os.environ or os.chdir in a normal python
program.

Example:
```python
with api.context(cwd=api.path['start_dir'].join('subdir')):
  # this step is run inside of the subdir directory.
  api.step("cat subdir/foo", ['cat', './foo'])
```

#### **class [ContextApi](/recipe_modules/context/api.py#44)([RecipeApi](/recipe_engine/recipe_api.py#850)):**

&emsp; **@contextmanager**<br>&mdash; **def [\_\_call\_\_](/recipe_modules/context/api.py#56)(self, cwd=None, env_prefixes=None, env_suffixes=None, env=None, infra_steps=None):**

Allows adjustment of multiple context values in a single call.

Args:
  * cwd (Path) - the current working directory to use for all steps.
    To 'reset' to the original cwd at the time recipes started, pass
    `api.path['start_dir']`.
  * env_prefixes (dict) - Environmental variable prefix augmentations. See
      below for more info.
  * env_suffixes (dict) - Environmental variable suffix augmentations. See
      below for more info.
  * env (dict) - Environmental variable overrides. See below for more info.
  * infra_steps (bool) - if steps in this context should be considered
    infrastructure steps. On failure, these will raise InfraFailure
    exceptions instead of StepFailure exceptions.

Environmental Variable Overrides:

Env is a mapping of environment variable name to the value you want that
environment variable to have. The value is one of:
  * None, indicating that the environment variable should be removed from
    the environment when the step runs.
  * A string value. Note that string values will be %-formatted with the
    current value of the environment at the time the step runs. This means
    that you can have a value like:
        "/path/to/my/stuff:%(PATH)s"
    Which, at the time the step executes, will inject the current value of
    $PATH.

"env_prefix" and "env_suffix" are a list of Path or strings that get
prefixed (or suffixed) to their respective environment variables, delimited
with the system's path separator. This can be used to add entries to
environment variables such as "PATH" and "PYTHONPATH". If prefixes are
specified and a value is also defined in "env", the value will be installed
as the last path component if it is not empty.

Look at the examples in "examples/" for examples of context module usage.

&emsp; **@property**<br>&mdash; **def [cwd](/recipe_modules/context/api.py#160)(self):**

Returns the current working directory that steps will run in.

**Returns (Path|None)** - The current working directory. A value of None is
equivalent to api.path['start_dir'], though only occurs if no cwd has been
set (e.g. in the outermost context of RunSteps).

&emsp; **@property**<br>&mdash; **def [env](/recipe_modules/context/api.py#170)(self):**

Returns modifications to the environment.

By default this is empty; There's no facility to observe the program's
startup environment. If you want to pass data to the recipe, it should be
done with properties.

**Returns (dict)** - The env-key -> value mapping of current environment
  modifications.

&emsp; **@property**<br>&mdash; **def [env\_prefixes](/recipe_modules/context/api.py#185)(self):**

Returns Path prefix modifications to the environment.

This will return a mapping of environment key to Path tuple for Path
prefixes registered with the environment.

**Returns (dict)** - The env-key -> value(Path) mapping of current
environment prefix modifications.

&emsp; **@property**<br>&mdash; **def [env\_suffixes](/recipe_modules/context/api.py#199)(self):**

Returns Path suffix modifications to the environment.

This will return a mapping of environment key to Path tuple for Path
suffixes registered with the environment.

**Returns (dict)** - The env-key -> value(Path) mapping of current
environment suffix modifications.

&emsp; **@property**<br>&mdash; **def [infra\_step](/recipe_modules/context/api.py#213)(self):**

Returns the current value of the infra_step setting.

**Returns (bool)** - True iff steps are currently considered infra steps.
### *recipe_modules* / [cq](/recipe_modules/cq)

[DEPS](/recipe_modules/cq/__init__.py#7): [buildbucket](#recipe_modules-buildbucket), [properties](#recipe_modules-properties), [step](#recipe_modules-step)

#### **class [CQApi](/recipe_modules/cq/api.py#13)([RecipeApi](/recipe_engine/recipe_api.py#850)):**

This module provides recipe API of LUCI CQ, aka pre-commit testing system.

More information about CQ:
  https://chromium.googlesource.com/infra/luci/luci-go/+/master/cq

&emsp; **@property**<br>&mdash; **def [experimental](/recipe_modules/cq/api.py#58)(self):**

Returns whether this build is triggered for a CQ experimental builder.

See `Builder.experiment_percentage` doc in [CQ
config](https://chromium.googlesource.com/infra/luci/luci-go/+/master/cq/api/config/v2/cq.proto)

Raises:
  CQInactive if CQ is `INACTIVE` for this build.

&mdash; **def [initialize](/recipe_modules/cq/api.py#40)(self):**

&emsp; **@property**<br>&mdash; **def [ordered\_gerrit\_changes](/recipe_modules/cq/api.py#83)(self):**

Returns list[bb_common_pb2.GerritChange] in order in which CLs should be
applied or submitted.

Raises:
  CQInactive if CQ is `INACTIVE` for this build.

&emsp; **@property**<br>&mdash; **def [props\_for\_child\_build](/recipe_modules/cq/api.py#97)(self):**

Returns properties dict meant to be passed to child builds.

These will preserve the CQ context of the current build in the
about-to-be-triggered child build.

```python
properties = {'foo': bar, 'protolike': proto_message}
properties.update(api.cq.props_for_child_build)
req = api.buildbucket.schedule_request(
    builder='child',
    gerrit_changes=list(api.buildbucket.build.input.gerrit_changes),
    properties=properties)
child_builds = api.buildbucket.schedule([req])
api.cq.record_triggered_builds(*child_builds)
```

The contents of returned dict should be treated as opaque blob,
it may be changed without notice.

&mdash; **def [record\_triggered\_build\_ids](/recipe_modules/cq/api.py#148)(self, \*build_ids):**

Adds given Buildbucket build ids to the list of triggered builds for CQ
to wait on corresponding build completion later.

Must be called after some step.

Args:
  * build_id (int or string): Buildbucket build id.

&mdash; **def [record\_triggered\_builds](/recipe_modules/cq/api.py#131)(self, \*builds):**

Adds given Buildbucket builds to the list of triggered builds for CQ
to wait on corresponding build completion later.

Must be called after some step.

Expected usage:
  ```python
    api.cq.record_triggered_builds(*api.buildbucket.schedule([req1, req2]))
  ```

Args:
  * [`Build`](https://chromium.googlesource.com/infra/luci/luci-go/+/master/buildbucket/proto/build.proto)
    objects, typically returned by `api.buildbucket.schedule`.

&emsp; **@property**<br>&mdash; **def [state](/recipe_modules/cq/api.py#53)(self):**

CQ state pertaining to this recipe execution.

&emsp; **@property**<br>&mdash; **def [top\_level](/recipe_modules/cq/api.py#71)(self):**

Returns whether CQ triggered this build directly.

Can be spoofed. *DO NOT USE FOR SECURITY CHECKS.*

Raises:
  CQInactive if CQ is `INACTIVE` for this build.

&emsp; **@property**<br>&mdash; **def [triggered\_build\_ids](/recipe_modules/cq/api.py#126)(self):**

Returns recorded Buildbucket build ids as a list of integers.
### *recipe_modules* / [file](/recipe_modules/file)

[DEPS](/recipe_modules/file/__init__.py#5): [json](#recipe_modules-json), [path](#recipe_modules-path), [python](#recipe_modules-python), [raw\_io](#recipe_modules-raw_io), [step](#recipe_modules-step)

File manipulation (read/write/delete/glob) methods.

#### **class [FileApi](/recipe_modules/file/api.py#81)([RecipeApi](/recipe_engine/recipe_api.py#850)):**

&mdash; **def [copy](/recipe_modules/file/api.py#117)(self, name, source, dest):**

Copies a file (including mode bits) from source to destination on the
local filesystem.

Behaves identically to shutil.copy.

Args:
  * name (str) - The name of the step.
  * source (Path|Placeholder) - The path to the file you want to copy.
  * dest (Path|Placeholder) - The path to the destination file name. If this
    path exists and is a directory, the basename of `source` will be
    appended to derive a path to a destination file.

Raises file.Error

&mdash; **def [copytree](/recipe_modules/file/api.py#137)(self, name, source, dest, symlinks=False):**

Recursively copies a directory tree.

Behaves identically to shutil.copytree.
`dest` must not exist.

Args:
  * name (str) - The name of the step.
  * source (Path) - The path of the directory to copy.
  * dest (Path) - The place where you want the recursive copy to show up.
    This must not already exist.
  * symlinks (bool) - Preserve symlinks. No effect on Windows.

Raises file.Error

&mdash; **def [ensure\_directory](/recipe_modules/file/api.py#343)(self, name, dest, mode=511):**

Ensures that `dest` exists and is a directory.

Args:
  * name (str) - The name of the step.
  * dest (Path) - The directory to ensure.
  * mode (int) - The mode to use if the directory doesn't exist. This method
    does not ensure the mode if the directory already exists (if you need
    that behaviour, file a bug).

Raises file.Error if the path exists but is not a directory.

&mdash; **def [filesizes](/recipe_modules/file/api.py#360)(self, name, files, test_data=None):**

Returns list of filesizes for the given files.

Args:
  * name (str) - The name of the step.
  * files (list[Path]) - Paths to files.

Returns list[int], size of each file in bytes.

&mdash; **def [flatten\_single\_directories](/recipe_modules/file/api.py#476)(self, name, path):**

Flattens singular directories, starting at path.

Example:

    $ mkdir -p dir/which_has/some/singlular/subdirs/
    $ touch dir/which_has/some/singlular/subdirs/with
    $ touch dir/which_has/some/singlular/subdirs/files
    $ flatten_single_directories(dir)
    $ ls dir
    with
    files

This can be useful when you just want the 'meat' of a very sparse directory
structure. For example, some tarballs like `foo-1.2.tar.gz` extract all
their contents into a subdirectory `foo-1.2/`.

Using this function would essentially move all the actual contents of the
extracted archive up to the top level directory, removing the need to e.g.
hard-code/find the subfolder name after extraction (not all archives are
even named after the subfolder they extract to).

Args:
  * name (str) - The name of the step.
  * path (Path|str) - The absolute path to begin flattening.

Raises file.Error

&mdash; **def [glob\_paths](/recipe_modules/file/api.py#276)(self, name, source, pattern, test_data=()):**

Performs glob expansion on `pattern`.

glob rules for `pattern` follow the same syntax as for the python `glob`
stdlib module.

Args:
  * name (str) - The name of the step.
  * source (Path) - The directory whose contents should be globbed.
  * pattern (str) - The glob pattern to apply under `source`.
  * test_data (iterable[str]) - Some default data for this step to return
    when running under simulation. This should be the list of file items
    found in this directory.

Returns list[Path] - All paths found.

Raises file.Error.

&mdash; **def [listdir](/recipe_modules/file/api.py#319)(self, name, source, test_data=()):**

List all files inside a directory.

Args:
  * name (str) - The name of the step.
  * source (Path) - The directory to list.
  * test_data (iterable[str]) - Some default data for this step to return
    when running under simulation. This should be the list of file items
    found in this directory.

Returns list[Path]

Raises file.Error.

&mdash; **def [move](/recipe_modules/file/api.py#158)(self, name, source, dest):**

Moves a file or directory.

Behaves identically to shutil.move.

Args:
  * name (str) - The name of the step.
  * source (Path) - The path of the item to move.
  * dest (Path) - The new name of the item.

Raises file.Error

&mdash; **def [read\_json](/recipe_modules/file/api.py#244)(self, name, source, test_data=''):**

Reads a file as UTF-8 encoded json.

Args:
  * name (str) - The name of the step.
  * source (Path) - The path of the file to read.
  * test_data (object) - Some default json serializable data for this step
    to return when running under simulation.

Returns (object) - The content of the file.

Raise file.Error

&mdash; **def [read\_raw](/recipe_modules/file/api.py#176)(self, name, source, test_data=''):**

Reads a file as raw data.

Args:
  * name (str) - The name of the step.
  * source (Path) - The path of the file to read.
  * test_data (str) - Some default data for this step to return when running
    under simulation.

Returns (str) - The unencoded (binary) contents of the file.

Raises file.Error

&mdash; **def [read\_text](/recipe_modules/file/api.py#210)(self, name, source, test_data=''):**

Reads a file as UTF-8 encoded text.

Args:
  * name (str) - The name of the step.
  * source (Path) - The path of the file to read.
  * test_data (str) - Some default data for this step to return when running
    under simulation.

Returns (str) - The content of the file.

Raises file.Error

&mdash; **def [remove](/recipe_modules/file/api.py#304)(self, name, source):**

Remove a file.

Does not raise Error if the file doesn't exist.

Args:
  * name (str) - The name of the step.
  * source (Path) - The file to remove.

Raises file.Error.

&mdash; **def [rmcontents](/recipe_modules/file/api.py#399)(self, name, source):**

Similar to rmtree, but removes only contents not the directory.

This is useful e.g. when removing contents of current working directory.
Deleting current working directory makes all further getcwd calls fail
until chdir is called. chdir would be tricky in recipes, so we provide
a call that doesn't delete the directory itself.

Args:
  * name (str) - The name of the step.
  * source (Path) - The directory whose contents should be removed.

Raises file.Error.

&mdash; **def [rmglob](/recipe_modules/file/api.py#417)(self, name, source, pattern):**

Removes all entries in `source` matching the glob `pattern`.

Args:
  * name (str) - The name of the step.
  * source (Path) - The directory whose contents should be filtered and
    removed.
  * pattern (str) - The glob pattern to apply under `source`. Anything
    matching this pattern will be removed.

Raises file.Error.

&mdash; **def [rmtree](/recipe_modules/file/api.py#382)(self, name, source):**

Recursively removes a directory.

This uses a native python on Linux/Mac, and uses `rd` on Windows to avoid
issues w.r.t. path lengths and read-only attributes. If the directory is
gone already, this returns without error.

Args:
  * name (str) - The name of the step.
  * source (Path) - The directory to remove.

Raises file.Error.

&mdash; **def [symlink](/recipe_modules/file/api.py#438)(self, name, source, linkname):**

Creates a symlink on the local filesystem.

Behaves identically to os.symlink.

Args:
  * name (str) - The name of the step.
  * source (Path|Placeholder) - The path to link from.
  * linkname (Path|Placeholder) - The destination to link to.

Raises file.Error

&mdash; **def [symlink\_tree](/recipe_modules/file/api.py#455)(self, root):**

Creates a SymlinkTree, given a root directory.

Args:
  * root (Path): root of a tree of symlinks.

&mdash; **def [truncate](/recipe_modules/file/api.py#463)(self, name, path, size_mb=100):**

Creates an empty file with path and size_mb on the local filesystem.

Args:
  * name (str) - The name of the step.
  * path (Path|str) - The absolute path to create.
  * size_mb (int) - The size of the file in megabytes. Defaults to 100

Raises file.Error

&mdash; **def [write\_json](/recipe_modules/file/api.py#261)(self, name, dest, data, indent=None):**

Write the given json serializable `data` to `dest`.

Args:
  * name (str) - The name of the step.
  * dest (Path) - The path of the file to write.
  * data (object) - Json serializable data to write.
  * indent (None|int|str) - The indent of the written JSON. See
    https://docs.python.org/3/library/json.html#json.dump for more details.

Raises file.Error.

&mdash; **def [write\_raw](/recipe_modules/file/api.py#195)(self, name, dest, data):**

Write the given `data` to `dest`.

Args:
  * name (str) - The name of the step.
  * dest (Path) - The path of the file to write.
  * data (str) - The data to write.

Raises file.Error.

&mdash; **def [write\_text](/recipe_modules/file/api.py#229)(self, name, dest, text_data):**

Write the given UTF-8 encoded `text_data` to `dest`.

Args:
  * name (str) - The name of the step.
  * dest (Path) - The path of the file to write.
  * text_data (str) - The UTF-8 encoded data to write.

Raises file.Error.
### *recipe_modules* / [futures](/recipe_modules/futures)

#### **class [FuturesApi](/recipe_modules/futures/api.py#39)([RecipeApi](/recipe_engine/recipe_api.py#850)):**

Provides access to the Recipe concurrency primitives.

&emsp; **@staticmethod**<br>&mdash; **def [iwait](/recipe_modules/futures/api.py#213)(futures, timeout=None, count=None):**

Iteratively yield up to `count` Futures as they become done.


This is analogous to `gevent.iwait`.

Usage:

    for future in api.futures.iwait(futures):
      # consume future

If you are not planning to consume the entire iwait iterator, you can
avoid the resource leak by doing, for example:

    with api.futures.iwait(a, b, c) as iter:
      for future in iter:
        if future is a:
          break

You might want to use `iwait` over `wait` if you want to process a group
of Futures in the order in which they complete. Compare:

  for task in iwait(swarming_tasks):
    # task is done, do something with it

  vs

  while swarming_tasks:
    task = wait(swarming_tasks, count=1)[0]  # some task is done
    swarming_tasks.remove(task)
    # do something with it

Args:
  * futures (List[Future]) - The Future objects to wait for.
  * timeout (None|seconds) - How long to wait for the Futures to be done.
  * count (None|int) - The number of Futures to yield. If None,
    yields all of them.

Yields futures in the order in which they complete until we hit the
timeout or count. May also be used with a context manager to avoid
leaking resources if you don't plan on consuming the entire iterable.

&mdash; **def [make\_channel](/recipe_modules/futures/api.py#105)(self):**

Returns a single-slot communication device for passing data and control
between concurrent functions.

This is useful for running 'background helper' type concurrent processes.

NOTE: It is strongly discouraged to pass Channel objects outside of a recipe
module. Access to the channel should be mediated via
a class/contextmanager/function which you return to the caller, and the
caller can call in a makes-sense-for-your-moudle's-API way.

See ./tests/background_helper.py for an example of how to use a Channel
correctly.

It is VERY RARE to need to use a Channel. You should avoid using this unless
you carefully consider and avoid the possibility of introducing deadlocks.

Channels will raise ValueError if used with @@@annotation@@@ mode.

&mdash; **def [spawn](/recipe_modules/futures/api.py#130)(self, func, \*args, \*\*kwargs):**

Prepares a Future to run `func(*args, **kwargs)` concurrently.

Any steps executed in `func` will only have manipulable StepPresentation
within the scope of the executed function.

Because this will spawn a greenlet on the same OS thread (and not,
for example a different OS thread or process), `func` can easily be an
inner function, closure, lambda, etc. In particular, func, args and kwargs
do not need to be pickle-able.

This function does NOT switch to the greenlet (you'll have to block on a
future/step for that to happen). In particular, this means that the
following pattern is safe:

    # self._my_future check + spawn + assignment is atomic because
    # no switch points occur.
    if not self._my_future:
      self._my_future = api.futures.spawn(func)

NOTE: If used in @@@annotator@@@ mode, this will block on the completion of
the Future before returning it.

Kwargs:

  * __name (str) - If provided, will assign this name to the spawned
    greenlet. Useful if this greenlet ends up raising an exception, this
    name will appear in the stderr logging for the engine.
  * Everything else is passed to `func`.

Returns a Future of `func`'s result.

&mdash; **def [spawn\_immediate](/recipe_modules/futures/api.py#169)(self, func, \*args, \*\*kwargs):**

Returns a Future to the concurrently running `func(*args, **kwargs)`.

This is like `spawn`, except that it IMMEDIATELY switches to the new
Greenlet. You may want to use this if you want to e.g. launch a background
step and then another step which waits for the daemon.

Kwargs:

  * __name (str) - If provided, will assign this name to the spawned
    greenlet. Useful if this greenlet ends up raising an exception, this
    name will appear in the stderr logging for the engine.
  * Everything else is passed to `func`.

Returns a Future of `func`'s result.

&emsp; **@staticmethod**<br>&mdash; **def [wait](/recipe_modules/futures/api.py#194)(futures, timeout=None, count=None):**

Blocks until `count` `futures` are done (or timeout occurs) then
returns the list of done futures.

This is analogous to `gevent.wait`.

Args:
  * futures (List[Future]) - The Future objects to wait for.
  * timeout (None|seconds) - How long to wait for the Futures to be done.
    If we hit the timeout, wait will return even if we haven't reached
    `count` Futures yet.
  * count (None|int) - The number of Futures to wait to be done. If None,
    waits for all of them.

Returns the list of done Futures, in the order in which they were done.
### *recipe_modules* / [generator\_script](/recipe_modules/generator_script)

[DEPS](/recipe_modules/generator_script/__init__.py#5): [context](#recipe_modules-context), [json](#recipe_modules-json), [path](#recipe_modules-path), [python](#recipe_modules-python), [step](#recipe_modules-step)

A simplistic method for running steps generated by an external script.

This module was created before there was a way to put recipes directly into
another repo. It is not recommended to use this, and it will be removed in the
near future.

#### **class [GeneratorScriptApi](/recipe_modules/generator_script/api.py#16)([RecipeApi](/recipe_engine/recipe_api.py#850)):**

&mdash; **def [\_\_call\_\_](/recipe_modules/generator_script/api.py#44)(self, path_to_script, \*args):**

Run a script and generate the steps emitted by that script.

The script will be invoked with --output-json /path/to/file.json. The script
is expected to exit 0 and write steps into that file. Once the script
outputs all of the steps to that file, the recipe will read the steps from
that file and execute them in order. Any *args specified will be
additionally passed to the script.

The step data is formatted as a list of JSON objects. Each object
corresponds to one step, and contains the following keys:
  * name: the name of this step.
  * cmd: a list of strings that indicate the command to run (e.g. argv)
  * env: a {key:value} dictionary of the environment variables to override.
   every value is formatted with the current environment with the python
   % operator, so a value of "%(PATH)s:/some/other/path" would resolve to
   the current PATH value, concatenated with ":/some/other/path"
  * cwd: an absolute path to the current working directory for this script.
  * always_run: a bool which indicates that this step should run, even if
    some previous step failed.
  * outputs_presentation_json: a bool which indicates that this step will
    emit a presentation json file. If this is True, the cmd will be extended
    with a `--presentation-json /path/to/file.json`. This file will be used
    to update the step's presentation on the build status page. The file
    will be expected to contain a single json object, with any of the
    following keys:
      * logs: {logname: [lines]} specifies one or more auxillary logs.
      * links: {link_name: link_content} to add extra links to the step.
      * step_summary_text: A string to set as the step summary.
      * step_text: A string to set as the step text.
      * properties: {prop: value} build_properties to add to the build
        status page. Note that these are write-only: The only way to read
        them is via the status page. There is intentionally no mechanism to
        read them back from inside of the recipes.
  * allow_subannotations: allow this step to emit legacy buildbot
    subannotations. If you don't know what this is, you shouldn't use it. If
    you know what it is, you also shouldn't use it.
### *recipe_modules* / [isolated](/recipe_modules/isolated)

[DEPS](/recipe_modules/isolated/__init__.py#1): [cipd](#recipe_modules-cipd), [context](#recipe_modules-context), [json](#recipe_modules-json), [path](#recipe_modules-path), [properties](#recipe_modules-properties), [raw\_io](#recipe_modules-raw_io), [runtime](#recipe_modules-runtime), [step](#recipe_modules-step)

#### **class [IsolatedApi](/recipe_modules/isolated/api.py#14)([RecipeApi](/recipe_engine/recipe_api.py#850)):**

API for interacting with isolated.

The isolated client implements a tar-like scatter-gather mechanism for
archiving files. The tool's source lives at
http://go.chromium.org/luci/client/cmd/isolated.

This module will deploy the client to [CACHE]/isolated_client/; users should
add this path to the named cache for their builder.

&mdash; **def [download](/recipe_modules/isolated/api.py#100)(self, step_name, isolated_hash, output_dir, isolate_server=None):**

Downloads an isolated tree from an isolate server.

Args:
  step_name (str): name of the step.
  isolated_hash (str): the hash of an isolated tree.
  output_dir (Path): Path to an output directory. If a non-existent
    directory, it will be created; else if already existent,
    conflicting files will be overwritten and non-conflicting files
    already in the directory will be ignored.
  isolate_server (str|None): an isolate server to donwload from; if None,
    the module's default server will be used instead.

&mdash; **def [initialize](/recipe_modules/isolated/api.py#33)(self):**

&emsp; **@property**<br>&mdash; **def [isolate\_server](/recipe_modules/isolated/api.py#52)(self):**

Returns the associated isolate server.

&mdash; **def [isolated](/recipe_modules/isolated/api.py#90)(self, root_dir):**

Returns an Isolated object that can be used to archive a set of files
and directories, relative to a given root directory.

Args:
  root_dir (Path): directory relative to which files and directory will be
    isolated.

&emsp; **@property**<br>&mdash; **def [namespace](/recipe_modules/isolated/api.py#58)(self):**

Returns the associated namespace.

&emsp; **@contextlib.contextmanager**<br>&mdash; **def [on\_path](/recipe_modules/isolated/api.py#76)(self):**

This context manager ensures the go isolated client is available on
$PATH.

Example:

    with api.isolated.on_path():
      # do your steps which require the isolated binary on path
### *recipe_modules* / [json](/recipe_modules/json)

[DEPS](/recipe_modules/json/__init__.py#5): [properties](#recipe_modules-properties), [python](#recipe_modules-python), [raw\_io](#recipe_modules-raw_io)

Methods for producing and consuming JSON.

#### **class [JsonApi](/recipe_modules/json/api.py#89)([RecipeApi](/recipe_engine/recipe_api.py#850)):**

&emsp; **@staticmethod**<br>&mdash; **def [dumps](/recipe_modules/json/api.py#90)(\*args, \*\*kwargs):**

Works like `json.dumps`.

&emsp; **@[returns\_placeholder](/recipe_engine/util.py#135)**<br>&mdash; **def [input](/recipe_modules/json/api.py#109)(self, data):**

A placeholder which will expand to a file path containing <data>.

&mdash; **def [is\_serializable](/recipe_modules/json/api.py#101)(self, obj):**

Returns True if the object is JSON-serializable.

&emsp; **@staticmethod**<br>&mdash; **def [loads](/recipe_modules/json/api.py#95)(data, \*\*kwargs):**

Works like `json.loads`, but strips out unicode objects (replacing them
with utf8-encoded str objects).

&emsp; **@[returns\_placeholder](/recipe_engine/util.py#135)**<br>&mdash; **def [output](/recipe_modules/json/api.py#114)(self, add_json_log=True, name=None, leak_to=None):**

A placeholder which will expand to '/tmp/file'.

If leak_to is provided, it must be a Path object. This path will be used in
place of a random temporary file, and the file will not be deleted at the
end of the step.

Args:
  * add_json_log (True|False|'on_failure') - Log a copy of the output json
    to a step link named `name`. If this is 'on_failure', only create this
    log when the step has a non-SUCCESS status.

&mdash; **def [read](/recipe_modules/json/api.py#129)(self, name, path, add_json_log=True, output_name=None, \*\*kwargs):**

Returns a step that reads a JSON file.

This method is deprecated. Use file.read_json instead.
### *recipe_modules* / [led](/recipe_modules/led)

[DEPS](/recipe_modules/led/__init__.py#5): [cipd](#recipe_modules-cipd), [json](#recipe_modules-json), [path](#recipe_modules-path), [service\_account](#recipe_modules-service_account), [step](#recipe_modules-step)

#### **class [LedApi](/recipe_modules/led/api.py#8)([RecipeApi](/recipe_engine/recipe_api.py#850)):**

Interface to the led tool.

"led" stands for LUCI editor. It allows users to debug and modify LUCI jobs.
It can be used to modify many aspects of a LUCI build, most commonly including
the recipes used.

The main interface this module provides is a direct call to the led binary:

  led_result = api.led(
    'get-builder', ['luci.chromium.try:chromium_presubmit'])
  final_data = led_result.then('edit-recipe-bundle').result

See the led binary for full documentation of commands.

&mdash; **def [\_\_call\_\_](/recipe_modules/led/api.py#52)(self, \*cmd):**

Runs led with the given arguments. Wraps result in a `LedResult`.
### *recipe_modules* / [path](/recipe_modules/path)

[DEPS](/recipe_modules/path/__init__.py#5): [platform](#recipe_modules-platform), [properties](#recipe_modules-properties)

All functions related to manipulating paths in recipes.

Recipes handle paths a bit differently than python does. All path manipulation
in recipes revolves around Path objects. These objects store a base path (always
absolute), plus a list of components to join with it. New paths can be derived
by calling the .join method with additional components.

In this way, all paths in Recipes are absolute, and are constructed from a small
collection of anchor points. The built-in anchor points are:
  * `api.path['start_dir']` - This is the directory that the recipe started in.
    it's similar to `cwd`, except that it's constant.
  * `api.path['cache']` - This directory is provided by whatever's running the
    recipe. Files and directories created under here /may/ be evicted in between
    runs of the recipe (i.e. to relieve disk pressure).
  * `api.path['cleanup']` - This directory is provided by whatever's running the
    recipe. Files and directories created under here /are guaranteed/ to be
    evicted in between runs of the recipe. Additionally, this directory is
    guaranteed to be empty when the recipe starts.
  * `api.path['tmp_base']` - This directory is the system-configured temp dir.
    This is a weaker form of 'cleanup', and its use should be avoided. This may
    be removed in the future (or converted to an alias of 'cleanup').
  * `api.path['checkout']` - This directory is set by various 'checkout' modules
    in recipes. It was originally intended to make recipes easier to read and
    make code somewhat generic or homogenous, but this was a mistake. New code
    should avoid 'checkout', and instead just explicitly pass paths around. This
    path may be removed in the future.

There are other anchor points which can be defined (e.g. by the
`depot_tools/infra_paths` module). Refer to those modules for additional
documentation.

#### **class [PathApi](/recipe_modules/path/api.py#213)([RecipeApi](/recipe_engine/recipe_api.py#850)):**

&mdash; **def [\_\_getitem\_\_](/recipe_modules/path/api.py#472)(self, name):**

Gets the base path named `name`. See module docstring for more
information.

&mdash; **def [abs\_to\_path](/recipe_modules/path/api.py#402)(self, abs_string_path):**

Converts an absolute path string `string_path` to a real Path object,
using the most appropriate known base path.

  * abs_string_path MUST be an absolute path
  * abs_string_path MUST be rooted in one of the configured base paths known
    to the path module.

This method will find the longest match in all the following:
  * module resource paths
  * recipe resource paths
  * repo paths
  * dynamic_paths
  * base_paths

Example:
```
# assume [START_DIR] == "/basis/dir/for/recipe"
api.path.abs_to_path("/basis/dir/for/recipe/some/other/dir") ->
  Path("[START_DIR]/some/other/dir")
```

Raises an ValueError if the preconditions are not met, otherwise returns the
Path object.

&mdash; **def [assert\_absolute](/recipe_modules/path/api.py#342)(self, path):**

Raises AssertionError if the given path is not an absolute path.

Args:
  * path (Path|str) - The path to check.

&mdash; **def [get](/recipe_modules/path/api.py#465)(self, name, default=None):**

Gets the base path named `name`. See module docstring for more
information.

&mdash; **def [get\_config\_defaults](/recipe_modules/path/api.py#225)(self):**

Internal recipe implementation function.

&mdash; **def [initialize](/recipe_modules/path/api.py#287)(self):**

Internal recipe implementation function.

&mdash; **def [mkdtemp](/recipe_modules/path/api.py#350)(self, prefix=tempfile.template):**

Makes a new temporary directory, returns Path to it.

Args:
  * prefix (str) - a tempfile template for the directory name (defaults
    to "tmp").

Returns a Path to the new directory.

&mdash; **def [mkstemp](/recipe_modules/path/api.py#375)(self, prefix=tempfile.template):**

Makes a new temporary file, returns Path to it.

Args:
  * prefix (str) - a tempfile template for the file name (defaults to
    "tmp").

Returns a Path to the new file. Unlike tempfile.mkstemp, the file's file
descriptor is closed.

&mdash; **def [mock\_add\_paths](/recipe_modules/path/api.py#321)(self, path):**

For testing purposes, mark that |path| exists.

&mdash; **def [mock\_copy\_paths](/recipe_modules/path/api.py#326)(self, source, dest):**

For testing purposes, copy |source| to |dest|.

&mdash; **def [mock\_remove\_paths](/recipe_modules/path/api.py#331)(self, path, filt=(lambda p: True)):**

For testing purposes, assert that |path| doesn't exist.

Args:
  * path (str|Path) - The path to remove.
  * filt (func[str] bool) - Called for every candidate path. Return
    True to remove this path.
### *recipe_modules* / [platform](/recipe_modules/platform)

Mockable system platform identity functions.

#### **class [PlatformApi](/recipe_modules/platform/api.py#23)([RecipeApi](/recipe_engine/recipe_api.py#850)):**

Provides host-platform-detection properties.

Mocks:
  * name (str): A value equivalent to something that might be returned by
    sys.platform.
  * bits (int): Either 32 or 64.

&emsp; **@property**<br>&mdash; **def [arch](/recipe_modules/platform/api.py#99)(self):**

Returns the current CPU architecture.

TODO: This is currently always hard-coded to 'intel'... Apparently no one
has actually needed this function?

&emsp; **@property**<br>&mdash; **def [bits](/recipe_modules/platform/api.py#89)(self):**

Returns the bitness of the userland for the current system (either 32 or
64 bit).

TODO: If anyone needs to query for the kernel bitness, another accessor
should be added.

&emsp; **@property**<br>&mdash; **def [cpu\_count](/recipe_modules/platform/api.py#108)(self):**

The number of CPU cores, according to multiprocessing.cpu_count().

&emsp; **@property**<br>&mdash; **def [is\_linux](/recipe_modules/platform/api.py#75)(self):**

Returns True iff the recipe is running on Linux.

&emsp; **@property**<br>&mdash; **def [is\_mac](/recipe_modules/platform/api.py#70)(self):**

Returns True iff the recipe is running on OS X.

&emsp; **@property**<br>&mdash; **def [is\_win](/recipe_modules/platform/api.py#65)(self):**

Returns True iff the recipe is running on Windows.

&emsp; **@property**<br>&mdash; **def [name](/recipe_modules/platform/api.py#80)(self):**

Returns the current platform name which will be in:
* win
* mac
* linux

&emsp; **@staticmethod**<br>&mdash; **def [normalize\_platform\_name](/recipe_modules/platform/api.py#113)(plat):**

One of python's sys.platform values -> 'win', 'linux' or 'mac'.
### *recipe_modules* / [properties](/recipe_modules/properties)

Provides access to the recipes input properties.

Every recipe is run with a JSON object called "properties". These contain all
inputs to the recipe. Some common examples would be properties like "revision",
which the build scheduler sets to tell a recipe to build/test a certain
revision.

The properties that affect a particular recipe are defined by the recipe itself,
and this module provides access to them.

Recipe properties are read-only; the values obtained via this API reflect the
values provided to the recipe engine at the beginning of execution. There is
intentionally no API to write property values (lest they become a kind of
random-access global variable).

#### **class [PropertiesApi](/recipe_modules/properties/api.py#28)([RecipeApiPlain](/recipe_engine/recipe_api.py#718), collections.Mapping):**

PropertiesApi implements all the standard Mapping functions, so you
can use it like a read-only dict.

&mdash; **def [legacy](/recipe_modules/properties/api.py#54)(self):**

DEPRECATED: Returns a set of properties, possibly used by legacy
scripts.

This excludes any recipe module-specific properties (i.e. those beginning
with `$`).

Instead of passing all of the properties as a blob, please consider passing
specific arguments to scripts that need them. Doing this makes it much
easier to debug and diagnose which scripts use which properties.

&mdash; **def [thaw](/recipe_modules/properties/api.py#78)(self):**

Returns a read-write copy of all of the properties.
### *recipe_modules* / [python](/recipe_modules/python)

[DEPS](/recipe_modules/python/__init__.py#5): [context](#recipe_modules-context), [raw\_io](#recipe_modules-raw_io), [step](#recipe_modules-step)

Provides methods for running python scripts correctly.

This includes support for `vpython`, and knows how to specify parameters
correctly for bots (e.g. ensuring that python is working on Windows, passing the
unbuffered flag, etc.)

#### **class [PythonApi](/recipe_modules/python/api.py#17)([RecipeApi](/recipe_engine/recipe_api.py#850)):**

&mdash; **def [\_\_call\_\_](/recipe_modules/python/api.py#18)(self, name, script, args=None, unbuffered=True, venv=None, \*\*kwargs):**

Return a step to run a python script with arguments.

**TODO**: We should just use a single "args" list. Having "script"
separate but required/first leads to weird things like:

    (... script='-m', args=['module'])

Args:
  * name (str): The name of the step.
  * script (str or Path): The Path of the script to run, or the first
      command-line argument to pass to Python.
  * args (list or None): If not None, additional arguments to pass to the
      Python command.
  * unbuffered (bool): If True, run Python in unbuffered mode.
  * venv (None or False or True or Path): If True, run the script through
      "vpython". This will, by default, probe the target script for a
      configured VirtualEnv and, failing that, use an empty VirtualEnv. If a
      Path, this is a path to an explicit "vpython" VirtualEnv spec file to
      use. If False or None (default), the script will be run through the
      standard Python interpreter.
  * kwargs: Additional keyword arguments to forward to "step".

**Returns (`step_data.StepData`)** - The StepData object as returned by
api.step.

&mdash; **def [failing\_step](/recipe_modules/python/api.py#114)(self, name, text, as_log=None):**

Runs a failing step (exits 1).

&mdash; **def [infra\_failing\_step](/recipe_modules/python/api.py#118)(self, name, text, as_log=None):**

Runs an infra-failing step (exits 1).

&mdash; **def [inline](/recipe_modules/python/api.py#63)(self, name, program, add_python_log=True, \*\*kwargs):**

Run an inline python program as a step.

Program is output to a temp file and run when this step executes.

Args:
  * name (str) - The name of the step
  * program (str) - The literal python program text. This will be dumped to
    a file and run like `python /path/to/file.py`
  * add_python_log (bool) - Whether to add a 'python.inline' link on this
    step on the build page. If true, the link will point to a log with
    a copy of `program`.

**Returns (`step_data.StepData`)** - The StepData object as returned by
api.step.

&mdash; **def [result\_step](/recipe_modules/python/api.py#91)(self, name, text, retcode, as_log=None, \*\*kwargs):**

Runs a no-op step that exits with a specified return code.

The recipe engine will raise an exception when seeing a return code != 0.

&mdash; **def [succeeding\_step](/recipe_modules/python/api.py#110)(self, name, text, as_log=None):**

Runs a succeeding step (exits 0).
### *recipe_modules* / [random](/recipe_modules/random)

Allows randomness in recipes.

This module sets up an internal instance of 'random.Random'. In tests, this is
seeded with `1234`, or a seed of your choosing (using the test_api's `seed()`
method)

All members of `random.Random` are exposed via this API with getattr.

NOTE: This is based on the python `random` module, and so all caveats which
apply there also apply to this (i.e. don't use it for anything resembling
crypto).

Example:

    def RunSteps(api):
      my_list = range(100)
      api.random.shuffle(my_list)
      # my_list is now random!

#### **class [RandomApi](/recipe_modules/random/api.py#31)([RecipeApi](/recipe_engine/recipe_api.py#850)):**

&mdash; **def [\_\_getattr\_\_](/recipe_modules/random/api.py#38)(self, name):**

Access a member of `random.Random`.
### *recipe_modules* / [raw\_io](/recipe_modules/raw_io)

Provides objects for reading and writing raw data to and from steps.

#### **class [RawIOApi](/recipe_modules/raw_io/api.py#259)([RecipeApi](/recipe_engine/recipe_api.py#850)):**

&emsp; **@[returns\_placeholder](/recipe_engine/util.py#135)**<br>&emsp; **@staticmethod**<br>&mdash; **def [input](/recipe_modules/raw_io/api.py#260)(data, suffix='', name=None):**

Returns a Placeholder for use as a step argument.

This placeholder can be used to pass data to steps. The recipe engine will
dump the 'data' into a file, and pass the filename to the command line
argument.

data MUST be of type 'str' (not basestring, not unicode).

If 'suffix' is not '', it will be used when the engine calls
tempfile.mkstemp.

See examples/full.py for usage example.

&emsp; **@[returns\_placeholder](/recipe_engine/util.py#135)**<br>&emsp; **@staticmethod**<br>&mdash; **def [input\_text](/recipe_modules/raw_io/api.py#278)(data, suffix='', name=None):**

Returns a Placeholder for use as a step argument.

data MUST be of type 'str' (not basestring, not unicode). The str is
expected to have valid utf-8 data in it.

Similar to input(), but ensures that 'data' is valid utf-8 text. Any
non-utf-8 characters will be replaced with �.

&emsp; **@[returns\_placeholder](/recipe_engine/util.py#135)**<br>&emsp; **@staticmethod**<br>&mdash; **def [output](/recipe_modules/raw_io/api.py#291)(suffix='', leak_to=None, name=None, add_output_log=False):**

Returns a Placeholder for use as a step argument, or for std{out,err}.

If 'leak_to' is None, the placeholder is backed by a temporary file with
a suffix 'suffix'. The file is deleted when the step finishes.

If 'leak_to' is not None, then it should be a Path and placeholder
redirects IO to a file at that path. Once step finishes, the file is
NOT deleted (i.e. it's 'leaking'). 'suffix' is ignored in that case.

Args:
   * add_output_log (True|False|'on_failure') - Log a copy of the output
     to a step link named `name`. If this is 'on_failure', only create this
     log when the step has a non-SUCCESS status.

&emsp; **@[returns\_placeholder](/recipe_engine/util.py#135)**<br>&emsp; **@staticmethod**<br>&mdash; **def [output\_dir](/recipe_modules/raw_io/api.py#329)(suffix='', leak_to=None, name=None):**

Returns a directory Placeholder for use as a step argument.

If 'leak_to' is None, the placeholder is backed by a temporary dir with
a suffix 'suffix'. The dir is deleted when the step finishes.

If 'leak_to' is not None, then it should be a Path and placeholder
redirects IO to a dir at that path. Once step finishes, the dir is
NOT deleted (i.e. it's 'leaking'). 'suffix' is ignored in that case.

&emsp; **@[returns\_placeholder](/recipe_engine/util.py#135)**<br>&emsp; **@staticmethod**<br>&mdash; **def [output\_text](/recipe_modules/raw_io/api.py#311)(suffix='', leak_to=None, name=None, add_output_log=False):**

Returns a Placeholder for use as a step argument, or for std{out,err}.

Similar to output(), but uses an OutputTextPlaceholder, which expects utf-8
encoded text.
Similar to input(), but tries to decode the resulting data as utf-8 text,
replacing any decoding errors with �.

Args:
   * add_output_log (True|False|'on_failure') - Log a copy of the output
     to a step link named `name`. If this is 'on_failure', only create this
     log when the step has a non-SUCCESS status.
### *recipe_modules* / [runtime](/recipe_modules/runtime)

[DEPS](/recipe_modules/runtime/__init__.py#5): [properties](#recipe_modules-properties)

#### **class [RuntimeApi](/recipe_modules/runtime/api.py#8)([RecipeApi](/recipe_engine/recipe_api.py#850)):**

This module assists in experimenting with production recipes.

For example, when migrating builders from Buildbot to pure LUCI stack.

&emsp; **@property**<br>&mdash; **def [is\_experimental](/recipe_modules/runtime/api.py#26)(self):**

True if this recipe is currently running in experimental mode.

Typical usage is to modify steps which produce external side-effects so that
non-production runs of the recipe do not affect production data.

Examples:
  * Uploading to an alternate google storage file name when in non-prod mode
  * Appending a 'non-production' tag to external RPCs

&emsp; **@property**<br>&mdash; **def [is\_luci](/recipe_modules/runtime/api.py#18)(self):**

True if this recipe is currently running on LUCI stack.

Should be used only during migration from Buildbot to LUCI stack.
### *recipe_modules* / [scheduler](/recipe_modules/scheduler)

[DEPS](/recipe_modules/scheduler/__init__.py#8): [buildbucket](#recipe_modules-buildbucket), [json](#recipe_modules-json), [platform](#recipe_modules-platform), [properties](#recipe_modules-properties), [raw\_io](#recipe_modules-raw_io), [runtime](#recipe_modules-runtime), [step](#recipe_modules-step), [time](#recipe_modules-time)

API for interacting with the LUCI Scheduler service.

Depends on 'prpc' binary available in $PATH:
  https://godoc.org/go.chromium.org/luci/grpc/cmd/prpc
Documentation for scheduler API is in
  https://chromium.googlesource.com/infra/luci/luci-go/+/master/scheduler/api/scheduler/v1/scheduler.proto
RPCExplorer available at
  https://luci-scheduler.appspot.com/rpcexplorer/services/scheduler.Scheduler

#### **class [SchedulerApi](/recipe_modules/scheduler/api.py#26)([RecipeApi](/recipe_engine/recipe_api.py#850)):**

A module for interacting with LUCI Scheduler service.

&mdash; **def [emit\_trigger](/recipe_modules/scheduler/api.py#138)(self, trigger, project, jobs, step_name=None):**

Emits trigger to one or more jobs of a given project.

Args:
  trigger (Trigger): defines payload to trigger jobs with.
  project (str): name of the project in LUCI Config service, which is used
    by LUCI Scheduler instance. See https://luci-config.appspot.com/.
  jobs (iterable of str): job names per LUCI Scheduler config for the given
    project. These typically are the same as builder names.

&mdash; **def [emit\_triggers](/recipe_modules/scheduler/api.py#150)(self, trigger_project_jobs, timestamp_usec=None, step_name=None):**

Emits a batch of triggers spanning one or more projects.

Up to date documentation is at
https://chromium.googlesource.com/infra/luci/luci-go/+/master/scheduler/api/scheduler/v1/scheduler.proto

Args:
  trigger_project_jobs (iterable of tuples(trigger, project, jobs)):
    each tuple corresponds to parameters of `emit_trigger` API above.
  timestamp_usec (int): unix timestamp in microseconds.
    Useful for idempotency of calls if your recipe is doing its own retries.
    https://chromium.googlesource.com/infra/luci/luci-go/+/master/scheduler/api/scheduler/v1/triggers.proto

&emsp; **@property**<br>&mdash; **def [host](/recipe_modules/scheduler/api.py#47)(self):**

Returns the backend hostname used by this module.

&mdash; **def [set\_host](/recipe_modules/scheduler/api.py#52)(self, host):**

Changes the backend hostname used by this module.

Args:
  host (str): server host (e.g. 'luci-scheduler.appspot.com').

&emsp; **@property**<br>&mdash; **def [triggers](/recipe_modules/scheduler/api.py#39)(self):**

Returns a list of triggers that triggered the current build.

A trigger is an instance of triggers_pb2.Trigger.
### *recipe_modules* / [service\_account](/recipe_modules/service_account)

[DEPS](/recipe_modules/service_account/__init__.py#5): [path](#recipe_modules-path), [platform](#recipe_modules-platform), [raw\_io](#recipe_modules-raw_io), [step](#recipe_modules-step)

API for getting OAuth2 access tokens for LUCI tasks or private keys.

This is a thin wrapper over the luci-auth go executable (
https://godoc.org/go.chromium.org/luci/auth/client/cmd/luci-auth).

Depends on luci-auth to be in PATH.

#### **class [ServiceAccountApi](/recipe_modules/service_account/api.py#16)([RecipeApi](/recipe_engine/recipe_api.py#850)):**

&mdash; **def [default](/recipe_modules/service_account/api.py#57)(self):**

Returns an account associated with the task.

On LUCI, this is default account exposed through LUCI_CONTEXT["local_auth"]
protocol. When running locally this is an account the user logged in via
"luci-auth login ..." command prior to running the recipe.

&mdash; **def [from\_credentials\_json](/recipe_modules/service_account/api.py#66)(self, key_path):**

Returns a service account based on a JSON credentials file.

This is the file generated by Cloud Console when creating a service account
key. It contains the private key inside.

Args:
  key_path: (str|Path) object pointing to a service account JSON key.
### *recipe_modules* / [source\_manifest](/recipe_modules/source_manifest)

#### **class [SourceManfiestApi](/recipe_modules/source_manifest/api.py#32)([RecipeApi](/recipe_engine/recipe_api.py#850)):**

&mdash; **def [set\_json\_manifest](/recipe_modules/source_manifest/api.py#35)(self, name, data):**

Uploads a source manifest with the given name.

NOTE: Due to current implementation restrictions, this method may only be
called after some step has been run from the recipe. Calling this before
running any steps is invalid and will fail. We hope to lift this restriction
sometime after we don't need to support buildbot any more.

# TODO(iannucci): remove this restriction.

Args:
  * name (str) - the name of the manifest. These names must be valid LogDog
    stream names, and must be unique within a recipe run. e.g.
    * "main_checkout"
    * "bisect/deadbeef"
  * data (dict) - the JSONPB representation of the source_manifest.proto
    Manifest message.
### *recipe_modules* / [step](/recipe_modules/step)

[DEPS](/recipe_modules/step/__init__.py#8): [context](#recipe_modules-context), [path](#recipe_modules-path)

Step is the primary API for running steps (external programs, scripts,
etc.).

#### **class [StepApi](/recipe_modules/step/api.py#23)([RecipeApiPlain](/recipe_engine/recipe_api.py#718)):**

&emsp; **@property**<br>&mdash; **def [InfraFailure](/recipe_modules/step/api.py#88)(self):**

InfraFailure is a subclass of StepFailure, and will translate to a purple
build.

This exception is raised from steps which are marked as `infra_step`s when
they fail.

&emsp; **@property**<br>&mdash; **def [StepFailure](/recipe_modules/step/api.py#70)(self):**

This is the base Exception class for all step failures.

It can be manually raised from recipe code to cause the build to turn red.

Usage:
  * `raise api.StepFailure("some reason")`
  * `except api.StepFailure:`

&emsp; **@property**<br>&mdash; **def [StepWarning](/recipe_modules/step/api.py#82)(self):**

StepWarning is a subclass of StepFailure, and will translate to a yellow
build.

&emsp; **@recipe_api.composite_step**<br>&mdash; **def [\_\_call\_\_](/recipe_modules/step/api.py#251)(self, name, cmd, ok_ret=(0,), infra_step=False, wrapper=(), timeout=None, allow_subannotations=None, trigger_specs=None, stdout=None, stderr=None, stdin=None, step_test_data=None, cpu=CPU.MIXED_IO_CPU):**

Returns a step dictionary which is compatible with annotator.py.

Args:

  * name (string): The name of this step.
  * cmd (list of strings): in the style of subprocess.Popen or None to
    create a no-op fake step.
  * ok_ret (tuple or set of ints, 'any', 'all'): allowed return codes. Any
    unexpected return codes will cause an exception to be thrown. If you
    pass in the value 'any' or 'all', the engine will allow any return code
    to be returned. Defaults to {0}.
  * infra_step: Whether or not this is an infrastructure step.
    Infrastructure steps will place the step in an EXCEPTION state and raise
    InfraFailure.
  * wrapper: If supplied, a command to prepend to the executed step as a
    command wrapper.
  * timeout: If supplied, the recipe engine will kill the step after the
    specified number of seconds.
  * allow_subannotations (bool): if True, lets the step emit its own
      annotations. NOTE: Enabling this can cause some buggy behavior. Please
      strongly consider using step_result.presentation instead. If you have
      questions, please contact infra-dev@chromium.org.
  * trigger_specs: a list of trigger specifications
  * stdout: Placeholder to put step stdout into. If used, stdout won't
    appear in annotator's stdout (and |allow_subannotations| is ignored).
  * stderr: Placeholder to put step stderr into. If used, stderr won't
    appear in annotator's stderr.
  * stdin: Placeholder to read step stdin from.
  * step_test_data (func -> recipe_test_api.StepTestData): A factory which
      returns a StepTestData object that will be used as the default test
      data for this step. The recipe author can override/augment this object
      in the GenTests function.
  * cpu (None|int|step.CPU) - The estimated cost of this step in millicores.
    The recipe_engine will prevent more than the machine's millicore count
    worth of steps from running at once (i.e. steps will wait until there's
    enough core resource available). Waiting suprocesses are unblocked in
    capacitiy-available order. This means it's possible for pending tasks
    with large cpu requirements to 'starve' temporarially while other
    smaller cost tasks run in parallel. Equal-weight tasks will start in
    FIFO order. REMOTE_IO_BOUND (0 cost) steps will NEVER wait.

Returns a `step_data.StepData` for the running step.

&emsp; **@property**<br>&mdash; **def [active\_result](/recipe_modules/step/api.py#98)(self):**

The currently active (open) result from the last step that was run. This
is a `step_data.StepData` object.

Allows you to do things like:
```python
try:
  api.step('run test', [..., api.json.output()])
finally:
  result = api.step.active_result
  if result.json.output:
    new_step_text = result.json.output['step_text']
    api.step.active_result.presentation.step_text = new_step_text
```

This will update the step_text of the test, even if the test fails. Without
this api, the above code would look like:

```python
try:
  result = api.step('run test', [..., api.json.output()])
except api.StepFailure as f:
  result = f.result
  raise
finally:
  if result.json.output:
    new_step_text = result.json.output['step_text']
    api.step.active_result.presentation.step_text = new_step_text
```

&emsp; **@property**<br>&mdash; **def [defer\_results](/recipe_modules/step/api.py#246)(self):**

See recipe_api.py for docs. 

&emsp; **@contextlib.contextmanager**<br>&mdash; **def [nest](/recipe_modules/step/api.py#155)(self, name, status='worst'):**

Nest allows you to nest steps hierarchically on the build UI.

This generates a dummy step with the provided name in the current namespace.
All other steps run within this `with` statement will be nested inside of
this dummy step. Nested steps can also nest within each other.

The presentation for the dummy step can be updated (e.g. to add step_text,
step_links, etc.) or set the step's status. If you do not set the status,
it will be calculated from the status' of all the steps run within this one
according to the `status` algorithm selected.
  1. If there's an active exception when leaving the `with` statement, the
     status will be one of FAILUR, WARNING or EXCEPTION (depending on the
     type of exception).
  2. Otherwise:
     1. If the status algorithm is 'worst', it will assume the status of the
        worst child step. This is useful for when your nest step runs e.g.
        a bunch of test shards. If any shard fails, you want the nest step
        to fail as well.
     2. If the status algorithm is 'last', it will assume the status of the
        last child step. This is useful for when you're using the nest step
        to encapsulate a sequence operation where only the last step's
        status really matters.

Example:

    # status='worst'
    with api.step.nest('run test'):
      with api.step.defer_results():
        for shard in xrange(4):
          run_shard('test', shard)

    # status='last'
    with api.step.nest('do upload'):
      for attempt in xrange(4):
        try:
          do_upload()  # first one fails, but second succeeds.
        except api.step.StepFailure:
          pass
      else:
        report_error()

    # manually adjust status
    with api.step.nest('custom thing') as presentation:
      # stuff!
      presentation.status = 'FAILURE'  # or whatever

NOTE/DEPRECATION: The object yielded also has a '.presentation' field to be
compatible with code that treats the yielded object as a StepData object. If
you see such code, please updaet it to treat the yielded object directly as
StepPresentation instead.

Args:

  * name (str) - The name of this step.
  * status ('worst'|'last') - The algorithm to use to pick a
    `presentation.status` if the recipe doesn't set one explicitly.

Yields a StepPresentation for this dummy step, which you may update as you
please.
### *recipe_modules* / [swarming](/recipe_modules/swarming)

[DEPS](/recipe_modules/swarming/__init__.py#5): [cipd](#recipe_modules-cipd), [context](#recipe_modules-context), [isolated](#recipe_modules-isolated), [json](#recipe_modules-json), [path](#recipe_modules-path), [properties](#recipe_modules-properties), [raw\_io](#recipe_modules-raw_io), [runtime](#recipe_modules-runtime), [step](#recipe_modules-step)

#### **class [SwarmingApi](/recipe_modules/swarming/api.py#857)([RecipeApi](/recipe_engine/recipe_api.py#850)):**

API for interacting with swarming.

The tool's source lives at
http://go.chromium.org/luci/client/cmd/swarming.

This module will deploy the client to [CACHE]/swarming_client/; users should
add this path to the named cache for their builder.

&mdash; **def [collect](/recipe_modules/swarming/api.py#989)(self, name, tasks, output_dir=None, timeout=None):**

Waits on a set of Swarming tasks.

Args:
  name (str): The name of the step.
  tasks ((list(str|TaskRequestMetadata)): A list of ids or metadata objects
    corresponding to tasks to wait
  output_dir (Path|None): Where to download the tasks' isolated outputs. If
    set to None, they will not be downloaded; else, a given task's outputs
    will be downloaded to output_dir/<task id>/.
  timeout (str|None): The duration for which to wait on the tasks to finish.
    If set to None, there will be no timeout; else, timeout follows the
    format described by https://golang.org/pkg/time/#ParseDuration.

Returns:
  A list of TaskResult objects.

&mdash; **def [initialize](/recipe_modules/swarming/api.py#875)(self):**

&emsp; **@contextlib.contextmanager**<br>&mdash; **def [on\_path](/recipe_modules/swarming/api.py#906)(self):**

This context manager ensures the go swarming client is available on
$PATH.

Example:

    with api.swarming.on_path():
      # do your steps which require the swarming binary on path

&mdash; **def [task\_request](/recipe_modules/swarming/api.py#938)(self):**

Creates a new TaskRequest object.

See documentation for TaskRequest/TaskSlice to see how to build this up
into a full task.

Once your TaskRequest is complete, you can pass it to `trigger` in order to
have it start running on the swarming server.

&mdash; **def [trigger](/recipe_modules/swarming/api.py#949)(self, step_name, requests):**

Triggers a set of Swarming tasks.

Args:
  step_name (str): The name of the step.
  tasks (seq[TaskRequest]): A sequence of task request objects representing
    the tasks we want to trigger.

Returns:
  A list of TaskRequestMetadata objects.

&emsp; **@contextlib.contextmanager**<br>&mdash; **def [with\_server](/recipe_modules/swarming/api.py#920)(self, server):**

This context sets the server for Swarming calls.

Example:

  with api.swarming.server('new-swarming-server.com'):
    # perform swarming calls

Args:
  server (str): The swarming server to call within context.
### *recipe_modules* / [tempfile](/recipe_modules/tempfile)

[DEPS](/recipe_modules/tempfile/__init__.py#5): [file](#recipe_modules-file), [path](#recipe_modules-path)

Simplistic temporary directory manager (deprecated).

#### **class [TempfileApi](/recipe_modules/tempfile/api.py#12)([RecipeApi](/recipe_engine/recipe_api.py#850)):**

&emsp; **@contextlib.contextmanager**<br>&mdash; **def [temp\_dir](/recipe_modules/tempfile/api.py#13)(self, prefix):**

This makes a temporary directory which lives for the scope of the with
statement.

Example:
```python
with api.tempfile.temp_dir("some_prefix") as path:
  # use path
# path is deleted here.
```
### *recipe_modules* / [time](/recipe_modules/time)

[DEPS](/recipe_modules/time/__init__.py#5): [python](#recipe_modules-python)

Allows mockable access to the current time.

#### **class [TimeApi](/recipe_modules/time/api.py#12)([RecipeApi](/recipe_engine/recipe_api.py#850)):**

&mdash; **def [ms\_since\_epoch](/recipe_modules/time/api.py#49)(self):**

Returns current timestamp as an int number of milliseconds since epoch.
    

&mdash; **def [sleep](/recipe_modules/time/api.py#21)(self, secs):**

Suspend execution of |secs| (float) seconds. Does nothing in testing.

If secs > 60 (sleep longer than one minute), run a step to do the
sleep, so that if a user looks at a build, they know what the recipe is
doing.

&mdash; **def [time](/recipe_modules/time/api.py#41)(self):**

Return current timestamp as a float number of seconds since epoch.

&mdash; **def [utcnow](/recipe_modules/time/api.py#54)(self):**

Return current UTC time as a datetime.datetime.
### *recipe_modules* / [tricium](/recipe_modules/tricium)

[DEPS](/recipe_modules/tricium/__init__.py#5): [json](#recipe_modules-json), [properties](#recipe_modules-properties), [step](#recipe_modules-step)

API for Tricium analyzers to use.

#### **class [TriciumApi](/recipe_modules/tricium/api.py#13)([RecipeApi](/recipe_engine/recipe_api.py#850)):**

TriciumApi provides basic support for Tricium.

&mdash; **def [\_\_init\_\_](/recipe_modules/tricium/api.py#16)(self, repository, ref, paths, \*\*kwargs):**

Sets up the API.

This assumes that the input is a Tricium GitFileDetails
object, and the output is a Tricium Results object (see
https://chromium.googlesource.com/infra/infra/+/master/go/src/infra/tricium/api/v1/data.proto
for details and definitions).

&mdash; **def [add\_comment](/recipe_modules/tricium/api.py#42)(self, category, message, path, url='', start_line=0, end_line=0, start_char=0, end_char=0, suggestions=None):**

&emsp; **@property**<br>&mdash; **def [paths](/recipe_modules/tricium/api.py#30)(self):**

&emsp; **@property**<br>&mdash; **def [ref](/recipe_modules/tricium/api.py#38)(self):**

&emsp; **@property**<br>&mdash; **def [repository](/recipe_modules/tricium/api.py#34)(self):**

&mdash; **def [write\_comments](/recipe_modules/tricium/api.py#66)(self, dump=False):**
### *recipe_modules* / [url](/recipe_modules/url)

[DEPS](/recipe_modules/url/__init__.py#5): [context](#recipe_modules-context), [json](#recipe_modules-json), [path](#recipe_modules-path), [python](#recipe_modules-python), [raw\_io](#recipe_modules-raw_io)

Methods for interacting with HTTP(s) URLs.

#### **class [UrlApi](/recipe_modules/url/api.py#15)([RecipeApi](/recipe_engine/recipe_api.py#850)):**

&mdash; **def [get\_file](/recipe_modules/url/api.py#131)(self, url, path, step_name=None, headers=None, transient_retry=True, strip_prefix=None, timeout=None):**

GET data at given URL and writes it to file.

Args:
  * url: URL to request.
  * path (Path): the Path where the content will be written.
  * step_name: optional step name, 'fetch <url>' by default.
  * headers: a {header_name: value} dictionary for HTTP headers.
  * transient_retry (bool or int): Determines how transient HTTP errorts
      (>500) will be retried. If True (default), errors will be retried up
      to 10 times. If False, no transient retries will occur. If an integer
      is supplied, this is the number of transient retries to perform. All
      retries have exponential backoff applied.
  * strip_prefix (str or None): If not None, this prefix must be present at
      the beginning of the response, and will be stripped from the resulting
      content (e.g., GERRIT_JSON_PREFIX).
  * timeout: Timeout (see step.__call__).

**Returns (UrlApi.Response)** - Response with "path" as its "output" value.

**Raises:**
  * HTTPError, InfraHTTPError: if the request failed.
  * ValueError: If the request was invalid.

&mdash; **def [get\_json](/recipe_modules/url/api.py#187)(self, url, step_name=None, headers=None, transient_retry=True, strip_prefix=None, log=False, timeout=None, default_test_data=None):**

GET data at given URL and writes it to file.

Args:
  * url: URL to request.
  * step_name: optional step name, 'fetch <url>' by default.
  * headers: a {header_name: value} dictionary for HTTP headers.
  * transient_retry (bool or int): Determines how transient HTTP errorts
      (>500) will be retried. If True (default), errors will be retried up
      to 10 times. If False, no transient retries will occur. If an integer
      is supplied, this is the number of transient retries to perform. All
      retries have exponential backoff applied.
  * strip_prefix (str or None): If not None, this prefix must be present at
      the beginning of the response, and will be stripped from the resulting
      content (e.g., GERRIT_JSON_PREFIX).
  * log (bool): If True, emit the JSON content as a log.
  * timeout: Timeout (see step.__call__).
  * default_test_data (jsonish): If provided, use this as the unmarshalled
      JSON result when testing if no overriding data is available.

**Returns (UrlApi.Response)** - Response with the JSON as its "output"
value.

**Raises:**
  * HTTPError, InfraHTTPError: if the request failed.
  * ValueError: If the request was invalid.

&mdash; **def [get\_text](/recipe_modules/url/api.py#159)(self, url, step_name=None, headers=None, transient_retry=True, timeout=None, default_test_data=None):**

GET data at given URL and writes it to file.

Args:
  * url: URL to request.
  * step_name: optional step name, 'fetch <url>' by default.
  * headers: a {header_name: value} dictionary for HTTP headers.
  * transient_retry (bool or int): Determines how transient HTTP errorts
      (>500) will be retried. If True (default), errors will be retried up
      to 10 times. If False, no transient retries will occur. If an integer
      is supplied, this is the number of transient retries to perform. All
      retries have exponential backoff applied.
  * timeout: Timeout (see step.__call__).
  * default_test_data (str): If provided, use this as the text output when
      testing if no overriding data is available.

**Returns (UrlApi.Response)** - Response with the content as its output
value.

**Raises:**
  * HTTPError, InfraHTTPError: if the request failed.
  * ValueError: If the request was invalid.

&mdash; **def [join](/recipe_modules/url/api.py#95)(self, \*parts):**

Constructs a URL path from composite parts.

Args:
  * parts (str...): Strings to concastenate. Any leading or trailing slashes
      will be stripped from intermediate strings to ensure that they join
      together. Trailing slashes will not be stripped from the last part.

&mdash; **def [validate\_url](/recipe_modules/url/api.py#111)(self, v):**

Validates that "v" is a valid URL.

A valid URL has a scheme and netloc, and must begin with HTTP or HTTPS.

Args:
  * v (str): The URL to validate.

**Returns (bool)** - True if the URL is considered secure, False if not.

**Raises:**
  * ValueError: if "v" is not valid.
### *recipe_modules* / [uuid](/recipe_modules/uuid)

Allows test-repeatable access to a random UUID.

#### **class [UuidApi](/recipe_modules/uuid/api.py#11)([RecipeApi](/recipe_engine/recipe_api.py#850)):**

&mdash; **def [random](/recipe_modules/uuid/api.py#20)(self):**

Returns a random UUID string.
## Recipes

### *recipes* / [archive:examples/full](/recipe_modules/archive/examples/full.py)

[DEPS](/recipe_modules/archive/examples/full.py#7): [archive](#recipe_modules-archive), [context](#recipe_modules-context), [file](#recipe_modules-file), [json](#recipe_modules-json), [path](#recipe_modules-path), [platform](#recipe_modules-platform), [raw\_io](#recipe_modules-raw_io), [step](#recipe_modules-step)

&mdash; **def [RunSteps](/recipe_modules/archive/examples/full.py#19)(api):**
### *recipes* / [assertions:tests/assert-raises](/recipe_modules/assertions/tests/assert-raises.py)

[DEPS](/recipe_modules/assertions/tests/assert-raises.py#7): [assertions](#recipe_modules-assertions), [properties](#recipe_modules-properties), [step](#recipe_modules-step)

&mdash; **def [RunSteps](/recipe_modules/assertions/tests/assert-raises.py#16)(api):**
### *recipes* / [assertions:tests/assertions](/recipe_modules/assertions/tests/assertions.py)

[DEPS](/recipe_modules/assertions/tests/assertions.py#7): [assertions](#recipe_modules-assertions), [properties](#recipe_modules-properties), [step](#recipe_modules-step)

&mdash; **def [RunSteps](/recipe_modules/assertions/tests/assertions.py#13)(api):**
### *recipes* / [assertions:tests/attribute\_error](/recipe_modules/assertions/tests/attribute_error.py)

[DEPS](/recipe_modules/assertions/tests/attribute_error.py#7): [assertions](#recipe_modules-assertions), [properties](#recipe_modules-properties), [step](#recipe_modules-step)

&mdash; **def [RunSteps](/recipe_modules/assertions/tests/attribute_error.py#13)(api):**
### *recipes* / [assertions:tests/long\_message](/recipe_modules/assertions/tests/long_message.py)

[DEPS](/recipe_modules/assertions/tests/long_message.py#7): [assertions](#recipe_modules-assertions), [step](#recipe_modules-step)

&mdash; **def [RunSteps](/recipe_modules/assertions/tests/long_message.py#12)(api):**
### *recipes* / [assertions:tests/max\_diff](/recipe_modules/assertions/tests/max_diff.py)

[DEPS](/recipe_modules/assertions/tests/max_diff.py#7): [assertions](#recipe_modules-assertions), [properties](#recipe_modules-properties), [step](#recipe_modules-step)

&mdash; **def [RunSteps](/recipe_modules/assertions/tests/max_diff.py#13)(api):**
### *recipes* / [buildbucket:examples/full](/recipe_modules/buildbucket/examples/full.py)

[DEPS](/recipe_modules/buildbucket/examples/full.py#9): [buildbucket](#recipe_modules-buildbucket), [platform](#recipe_modules-platform), [properties](#recipe_modules-properties), [raw\_io](#recipe_modules-raw_io), [step](#recipe_modules-step)

This file is a recipe demonstrating the buildbucket recipe module.

&mdash; **def [RunSteps](/recipe_modules/buildbucket/examples/full.py#18)(api):**
### *recipes* / [buildbucket:run/multi](/recipe_modules/buildbucket/run/multi.py)

[DEPS](/recipe_modules/buildbucket/run/multi.py#12): [buildbucket](#recipe_modules-buildbucket), [properties](#recipe_modules-properties)

Launches multiple builds at the same revision.

&mdash; **def [RunSteps](/recipe_modules/buildbucket/run/multi.py#29)(api, build_requests, collect_builds):**
### *recipes* / [buildbucket:tests/build](/recipe_modules/buildbucket/tests/build.py)

[DEPS](/recipe_modules/buildbucket/tests/build.py#9): [buildbucket](#recipe_modules-buildbucket), [properties](#recipe_modules-properties), [step](#recipe_modules-step)

&mdash; **def [RunSteps](/recipe_modules/buildbucket/tests/build.py#16)(api):**
### *recipes* / [buildbucket:tests/collect](/recipe_modules/buildbucket/tests/collect.py)

[DEPS](/recipe_modules/buildbucket/tests/collect.py#5): [buildbucket](#recipe_modules-buildbucket), [properties](#recipe_modules-properties)

&mdash; **def [RunSteps](/recipe_modules/buildbucket/tests/collect.py#11)(api):**
### *recipes* / [buildbucket:tests/get](/recipe_modules/buildbucket/tests/get.py)

[DEPS](/recipe_modules/buildbucket/tests/get.py#11): [buildbucket](#recipe_modules-buildbucket), [json](#recipe_modules-json), [step](#recipe_modules-step)

&mdash; **def [RunSteps](/recipe_modules/buildbucket/tests/get.py#18)(api):**
### *recipes* / [buildbucket:tests/put](/recipe_modules/buildbucket/tests/put.py)

[DEPS](/recipe_modules/buildbucket/tests/put.py#5): [buildbucket](#recipe_modules-buildbucket), [properties](#recipe_modules-properties), [runtime](#recipe_modules-runtime)

&mdash; **def [RunSteps](/recipe_modules/buildbucket/tests/put.py#12)(api):**
### *recipes* / [buildbucket:tests/schedule](/recipe_modules/buildbucket/tests/schedule.py)

[DEPS](/recipe_modules/buildbucket/tests/schedule.py#9): [buildbucket](#recipe_modules-buildbucket), [properties](#recipe_modules-properties), [runtime](#recipe_modules-runtime), [step](#recipe_modules-step)

&mdash; **def [RunSteps](/recipe_modules/buildbucket/tests/schedule.py#17)(api):**
### *recipes* / [buildbucket:tests/search](/recipe_modules/buildbucket/tests/search.py)

[DEPS](/recipe_modules/buildbucket/tests/search.py#13): [buildbucket](#recipe_modules-buildbucket), [json](#recipe_modules-json), [properties](#recipe_modules-properties), [runtime](#recipe_modules-runtime), [step](#recipe_modules-step)

&mdash; **def [RunSteps](/recipe_modules/buildbucket/tests/search.py#22)(api):**
### *recipes* / [cipd:examples/full](/recipe_modules/cipd/examples/full.py)

[DEPS](/recipe_modules/cipd/examples/full.py#8): [cipd](#recipe_modules-cipd), [json](#recipe_modules-json), [path](#recipe_modules-path), [platform](#recipe_modules-platform), [properties](#recipe_modules-properties), [service\_account](#recipe_modules-service_account), [step](#recipe_modules-step)

&mdash; **def [RunSteps](/recipe_modules/cipd/examples/full.py#34)(api, use_pkg, pkg_files, pkg_dirs, pkg_vars, ver_files, install_mode, refs, tags):**
### *recipes* / [commit\_position:examples/full](/recipe_modules/commit_position/examples/full.py)

[DEPS](/recipe_modules/commit_position/examples/full.py#5): [commit\_position](#recipe_modules-commit_position), [step](#recipe_modules-step)

&mdash; **def [RunSteps](/recipe_modules/commit_position/examples/full.py#11)(api):**
### *recipes* / [context:examples/full](/recipe_modules/context/examples/full.py)

[DEPS](/recipe_modules/context/examples/full.py#7): [context](#recipe_modules-context), [path](#recipe_modules-path), [raw\_io](#recipe_modules-raw_io), [step](#recipe_modules-step)

&mdash; **def [RunSteps](/recipe_modules/context/examples/full.py#15)(api):**
### *recipes* / [context:tests/cwd](/recipe_modules/context/tests/cwd.py)

[DEPS](/recipe_modules/context/tests/cwd.py#5): [context](#recipe_modules-context), [path](#recipe_modules-path), [step](#recipe_modules-step)

&mdash; **def [RunSteps](/recipe_modules/context/tests/cwd.py#11)(api):**
### *recipes* / [context:tests/env](/recipe_modules/context/tests/env.py)

[DEPS](/recipe_modules/context/tests/env.py#5): [context](#recipe_modules-context), [path](#recipe_modules-path), [raw\_io](#recipe_modules-raw_io), [step](#recipe_modules-step)

&mdash; **def [RunSteps](/recipe_modules/context/tests/env.py#19)(api):**
### *recipes* / [context:tests/infra\_step](/recipe_modules/context/tests/infra_step.py)

[DEPS](/recipe_modules/context/tests/infra_step.py#5): [context](#recipe_modules-context), [path](#recipe_modules-path), [step](#recipe_modules-step)

&mdash; **def [RunSteps](/recipe_modules/context/tests/infra_step.py#11)(api):**
### *recipes* / [cq:examples/ordered\_cls](/recipe_modules/cq/examples/ordered_cls.py)

[DEPS](/recipe_modules/cq/examples/ordered_cls.py#10): [assertions](#recipe_modules-assertions), [buildbucket](#recipe_modules-buildbucket), [cq](#recipe_modules-cq), [properties](#recipe_modules-properties), [step](#recipe_modules-step)

&mdash; **def [RunSteps](/recipe_modules/cq/examples/ordered_cls.py#19)(api):**
### *recipes* / [cq:examples/trigger\_child\_builds](/recipe_modules/cq/examples/trigger_child_builds.py)

[DEPS](/recipe_modules/cq/examples/trigger_child_builds.py#9): [assertions](#recipe_modules-assertions), [buildbucket](#recipe_modules-buildbucket), [cq](#recipe_modules-cq), [json](#recipe_modules-json), [properties](#recipe_modules-properties), [step](#recipe_modules-step)

&mdash; **def [RunSteps](/recipe_modules/cq/examples/trigger_child_builds.py#19)(api):**
### *recipes* / [cq:tests/experimental](/recipe_modules/cq/tests/experimental.py)

[DEPS](/recipe_modules/cq/tests/experimental.py#7): [assertions](#recipe_modules-assertions), [cq](#recipe_modules-cq), [properties](#recipe_modules-properties), [step](#recipe_modules-step)

&mdash; **def [RunSteps](/recipe_modules/cq/tests/experimental.py#15)(api):**
### *recipes* / [cq:tests/triggered\_build\_ids](/recipe_modules/cq/tests/triggered_build_ids.py)

[DEPS](/recipe_modules/cq/tests/triggered_build_ids.py#5): [buildbucket](#recipe_modules-buildbucket), [cq](#recipe_modules-cq), [step](#recipe_modules-step)

&mdash; **def [RunSteps](/recipe_modules/cq/tests/triggered_build_ids.py#15)(api):**
### *recipes* / [cq:tests/type\_of\_run](/recipe_modules/cq/tests/type_of_run.py)

[DEPS](/recipe_modules/cq/tests/type_of_run.py#5): [cq](#recipe_modules-cq), [properties](#recipe_modules-properties), [step](#recipe_modules-step)

&mdash; **def [RunSteps](/recipe_modules/cq/tests/type_of_run.py#12)(api):**
### *recipes* / [engine\_tests/bad\_subprocess](/recipes/engine_tests/bad_subprocess.py)

[DEPS](/recipes/engine_tests/bad_subprocess.py#7): [platform](#recipe_modules-platform), [python](#recipe_modules-python)

Tests that daemons that hang on to STDOUT can't cause the engine to hang.

&mdash; **def [RunSteps](/recipes/engine_tests/bad_subprocess.py#13)(api):**
### *recipes* / [engine\_tests/comprehensive\_ui](/recipes/engine_tests/comprehensive_ui.py)

[DEPS](/recipes/engine_tests/comprehensive_ui.py#11): [python](#recipe_modules-python), [raw\_io](#recipe_modules-raw_io), [step](#recipe_modules-step)

A fast-running recipe which comprehensively covers all StepPresentation
features available in the recipe engine.

&mdash; **def [RunSteps](/recipes/engine_tests/comprehensive_ui.py#20)(api):**

&mdash; **def [named\_step](/recipes/engine_tests/comprehensive_ui.py#17)(api, name):**
### *recipes* / [engine\_tests/config\_operations](/recipes/engine_tests/config_operations.py)

[DEPS](/recipes/engine_tests/config_operations.py#41): [json](#recipe_modules-json), [step](#recipe_modules-step)

Tests that recipes can modify configuration options in various ways.

&mdash; **def [BaseConfig](/recipes/engine_tests/config_operations.py#12)(\*\*_kwargs):**

&mdash; **def [DumpRecipeEngineTestConfig](/recipes/engine_tests/config_operations.py#46)(api, config):**

&mdash; **def [RunSteps](/recipes/engine_tests/config_operations.py#51)(api):**

&emsp; **@config_ctx()**<br>&mdash; **def [test1](/recipes/engine_tests/config_operations.py#27)(c):**

&emsp; **@config_ctx(includes=['test2a'])**<br>&mdash; **def [test2](/recipes/engine_tests/config_operations.py#35)(c):**

&emsp; **@config_ctx()**<br>&mdash; **def [test2a](/recipes/engine_tests/config_operations.py#31)(c):**
### *recipes* / [engine\_tests/expect\_exception](/recipes/engine_tests/expect_exception.py)

[DEPS](/recipes/engine_tests/expect_exception.py#7): [step](#recipe_modules-step)

Tests that step_data can accept multiple specs at once.

&mdash; **def [RunSteps](/recipes/engine_tests/expect_exception.py#11)(api):**
### *recipes* / [engine\_tests/failure\_results](/recipes/engine_tests/failure_results.py)

[DEPS](/recipes/engine_tests/failure_results.py#12): [json](#recipe_modules-json), [step](#recipe_modules-step)

Tests that run_steps is handling recipe failures correctly.

&mdash; **def [RunSteps](/recipes/engine_tests/failure_results.py#17)(api):**
### *recipes* / [engine\_tests/functools\_partial](/recipes/engine_tests/functools_partial.py)

[DEPS](/recipes/engine_tests/functools_partial.py#12): [step](#recipe_modules-step)

Engine shouldn't explode when step_test_data gets functools.partial.

This is a regression test for a bug caused by this revision:
http://src.chromium.org/viewvc/chrome?revision=298072&view=revision

When this recipe is run (by run_test.py), the _print_step code is exercised.

&mdash; **def [RunSteps](/recipes/engine_tests/functools_partial.py#14)(api):**
### *recipes* / [engine\_tests/incorrect\_recipe\_result](/recipes/engine_tests/incorrect_recipe_result.py)

[DEPS](/recipes/engine_tests/incorrect_recipe_result.py#12): [json](#recipe_modules-json), [properties](#recipe_modules-properties), [step](#recipe_modules-step)

Tests that engine.py can handle unknown recipe results.

&mdash; **def [RunSteps](/recipes/engine_tests/incorrect_recipe_result.py#20)(api, props):**
### *recipes* / [engine\_tests/missing\_start\_dir](/recipes/engine_tests/missing_start_dir.py)

[DEPS](/recipes/engine_tests/missing_start_dir.py#7): [path](#recipe_modules-path), [step](#recipe_modules-step)

Tests that deleting the current working directory doesn't immediately fail.

&mdash; **def [RunSteps](/recipes/engine_tests/missing_start_dir.py#13)(api):**
### *recipes* / [engine\_tests/module\_injection\_site](/recipes/engine_tests/module_injection_site.py)

[DEPS](/recipes/engine_tests/module_injection_site.py#13): [path](#recipe_modules-path), [step](#recipe_modules-step)

This test serves to demonstrate that the ModuleInjectionSite object on
recipe modules (i.e. the `.m`) also contains a reference to the module which
owns it.

This was implemented to aid in refactoring some recipes (crbug.com/782142).

&mdash; **def [RunSteps](/recipes/engine_tests/module_injection_site.py#18)(api):**
### *recipes* / [engine\_tests/multi\_test\_data](/recipes/engine_tests/multi_test_data.py)

[DEPS](/recipes/engine_tests/multi_test_data.py#7): [raw\_io](#recipe_modules-raw_io), [step](#recipe_modules-step)

Tests that step_data can accept multiple specs at once.

&mdash; **def [RunSteps](/recipes/engine_tests/multi_test_data.py#12)(api):**
### *recipes* / [engine\_tests/multiple\_placeholders](/recipes/engine_tests/multiple_placeholders.py)

[DEPS](/recipes/engine_tests/multiple_placeholders.py#10): [assertions](#recipe_modules-assertions), [json](#recipe_modules-json), [step](#recipe_modules-step)

Tests error checking around multiple placeholders in a single step.

&mdash; **def [RunSteps](/recipes/engine_tests/multiple_placeholders.py#17)(api):**
### *recipes* / [engine\_tests/nonexistent\_command](/recipes/engine_tests/nonexistent_command.py)

[DEPS](/recipes/engine_tests/nonexistent_command.py#1): [step](#recipe_modules-step)

&mdash; **def [RunSteps](/recipes/engine_tests/nonexistent_command.py#3)(api):**
### *recipes* / [engine\_tests/placeholder\_exception](/recipes/engine_tests/placeholder_exception.py)

[DEPS](/recipes/engine_tests/placeholder_exception.py#10): [step](#recipe_modules-step)

Tests that placeholders can't wreck the world by exhausting the step stack.

&mdash; **def [RunSteps](/recipes/engine_tests/placeholder_exception.py#22)(api):**
### *recipes* / [engine\_tests/proto\_properties](/recipes/engine_tests/proto_properties.py)

[DEPS](/recipes/engine_tests/proto_properties.py#7): [assertions](#recipe_modules-assertions), [properties](#recipe_modules-properties)

&mdash; **def [RunSteps](/recipes/engine_tests/proto_properties.py#16)(api, properties, env_props):**
### *recipes* / [engine\_tests/recipe\_paths](/recipes/engine_tests/recipe_paths.py)

[DEPS](/recipes/engine_tests/recipe_paths.py#7): [path](#recipe_modules-path), [python](#recipe_modules-python), [step](#recipe_modules-step)

Tests that recipes have access to names, resources and their repo.

&mdash; **def [RunSteps](/recipes/engine_tests/recipe_paths.py#13)(api):**
### *recipes* / [engine\_tests/sort\_properties](/recipes/engine_tests/sort_properties.py)

[DEPS](/recipes/engine_tests/sort_properties.py#7): [step](#recipe_modules-step)

Tests that step presentation properties can be ordered.

&mdash; **def [RunSteps](/recipes/engine_tests/sort_properties.py#11)(api):**
### *recipes* / [engine\_tests/undeclared\_method](/recipes/engine_tests/undeclared_method.py)

[DEPS](/recipes/engine_tests/undeclared_method.py#7): [properties](#recipe_modules-properties), [python](#recipe_modules-python), [step](#recipe_modules-step)

&mdash; **def [RunSteps](/recipes/engine_tests/undeclared_method.py#19)(api, from_recipe, attribute, module):**
### *recipes* / [engine\_tests/unicode](/recipes/engine_tests/unicode.py)

[DEPS](/recipes/engine_tests/unicode.py#6): [properties](#recipe_modules-properties), [step](#recipe_modules-step)

&mdash; **def [RunSteps](/recipes/engine_tests/unicode.py#11)(api):**
### *recipes* / [engine\_tests/whitelist\_steps](/recipes/engine_tests/whitelist_steps.py)

[DEPS](/recipes/engine_tests/whitelist_steps.py#12): [context](#recipe_modules-context), [properties](#recipe_modules-properties), [step](#recipe_modules-step)

Tests that step_data can accept multiple specs at once.

&mdash; **def [RunSteps](/recipes/engine_tests/whitelist_steps.py#22)(api, fakeit):**
### *recipes* / [file:examples/copy](/recipe_modules/file/examples/copy.py)

[DEPS](/recipe_modules/file/examples/copy.py#5): [file](#recipe_modules-file), [json](#recipe_modules-json), [path](#recipe_modules-path)

&mdash; **def [RunSteps](/recipe_modules/file/examples/copy.py#12)(api):**
### *recipes* / [file:examples/copytree](/recipe_modules/file/examples/copytree.py)

[DEPS](/recipe_modules/file/examples/copytree.py#5): [file](#recipe_modules-file), [path](#recipe_modules-path)

&mdash; **def [RunSteps](/recipe_modules/file/examples/copytree.py#11)(api):**
### *recipes* / [file:examples/error](/recipe_modules/file/examples/error.py)

[DEPS](/recipe_modules/file/examples/error.py#5): [file](#recipe_modules-file), [path](#recipe_modules-path)

&mdash; **def [RunSteps](/recipe_modules/file/examples/error.py#11)(api):**
### *recipes* / [file:examples/flatten\_single\_directories](/recipe_modules/file/examples/flatten_single_directories.py)

[DEPS](/recipe_modules/file/examples/flatten_single_directories.py#5): [file](#recipe_modules-file), [path](#recipe_modules-path)

&mdash; **def [RunSteps](/recipe_modules/file/examples/flatten_single_directories.py#11)(api):**
### *recipes* / [file:examples/glob](/recipe_modules/file/examples/glob.py)

[DEPS](/recipe_modules/file/examples/glob.py#5): [file](#recipe_modules-file), [json](#recipe_modules-json), [path](#recipe_modules-path)

&mdash; **def [RunSteps](/recipe_modules/file/examples/glob.py#11)(api):**
### *recipes* / [file:examples/handle\_json\_file](/recipe_modules/file/examples/handle_json_file.py)

[DEPS](/recipe_modules/file/examples/handle_json_file.py#5): [file](#recipe_modules-file), [path](#recipe_modules-path)

&mdash; **def [RunSteps](/recipe_modules/file/examples/handle_json_file.py#11)(api):**
### *recipes* / [file:examples/listdir](/recipe_modules/file/examples/listdir.py)

[DEPS](/recipe_modules/file/examples/listdir.py#5): [file](#recipe_modules-file), [path](#recipe_modules-path)

&mdash; **def [RunSteps](/recipe_modules/file/examples/listdir.py#11)(api):**
### *recipes* / [file:examples/raw\_copy](/recipe_modules/file/examples/raw_copy.py)

[DEPS](/recipe_modules/file/examples/raw_copy.py#5): [file](#recipe_modules-file), [json](#recipe_modules-json), [path](#recipe_modules-path)

&mdash; **def [RunSteps](/recipe_modules/file/examples/raw_copy.py#12)(api):**
### *recipes* / [file:examples/symlink](/recipe_modules/file/examples/symlink.py)

[DEPS](/recipe_modules/file/examples/symlink.py#5): [file](#recipe_modules-file), [json](#recipe_modules-json), [path](#recipe_modules-path)

&mdash; **def [RunSteps](/recipe_modules/file/examples/symlink.py#12)(api):**
### *recipes* / [file:examples/truncate](/recipe_modules/file/examples/truncate.py)

[DEPS](/recipe_modules/file/examples/truncate.py#5): [file](#recipe_modules-file), [path](#recipe_modules-path)

&mdash; **def [RunSteps](/recipe_modules/file/examples/truncate.py#11)(api):**
### *recipes* / [futures:examples/background\_helper](/recipe_modules/futures/examples/background_helper.py)

[DEPS](/recipe_modules/futures/examples/background_helper.py#8): [futures](#recipe_modules-futures), [json](#recipe_modules-json), [path](#recipe_modules-path), [python](#recipe_modules-python), [raw\_io](#recipe_modules-raw_io), [step](#recipe_modules-step)

&mdash; **def [RunSteps](/recipe_modules/futures/examples/background_helper.py#78)(api):**

&mdash; **def [manage\_helper](/recipe_modules/futures/examples/background_helper.py#21)(api, chn):**

&emsp; **@contextmanager**<br>&mdash; **def [run\_helper](/recipe_modules/futures/examples/background_helper.py#51)(api):**

Runs the background helper.

Yields control once helper is ready. Kills helper once leaving the context
manager.

This is an example of what your recipe module code would look like. Note that
we don't pass the channel to the 'user' code (i.e. RunSteps).
### *recipes* / [futures:examples/extreme\_namespaces](/recipe_modules/futures/examples/extreme_namespaces.py)

[DEPS](/recipe_modules/futures/examples/extreme_namespaces.py#5): [futures](#recipe_modules-futures), [step](#recipe_modules-step)

&mdash; **def [Level1](/recipe_modules/futures/examples/extreme_namespaces.py#16)(api, i):**

&mdash; **def [Level2](/recipe_modules/futures/examples/extreme_namespaces.py#11)(api, i):**

&mdash; **def [RunSteps](/recipe_modules/futures/examples/extreme_namespaces.py#22)(api):**
### *recipes* / [futures:examples/fan\_out\_in](/recipe_modules/futures/examples/fan_out_in.py)

[DEPS](/recipe_modules/futures/examples/fan_out_in.py#5): [futures](#recipe_modules-futures), [python](#recipe_modules-python), [step](#recipe_modules-step)

&mdash; **def [RunSteps](/recipe_modules/futures/examples/fan_out_in.py#12)(api):**
### *recipes* / [futures:examples/lazy\_fan\_out\_in](/recipe_modules/futures/examples/lazy_fan_out_in.py)

[DEPS](/recipe_modules/futures/examples/lazy_fan_out_in.py#5): [futures](#recipe_modules-futures), [python](#recipe_modules-python), [step](#recipe_modules-step)

&mdash; **def [RunSteps](/recipe_modules/futures/examples/lazy_fan_out_in.py#12)(api):**
### *recipes* / [futures:examples/lazy\_fan\_out\_in\_early\_abort](/recipe_modules/futures/examples/lazy_fan_out_in_early_abort.py)

[DEPS](/recipe_modules/futures/examples/lazy_fan_out_in_early_abort.py#5): [futures](#recipe_modules-futures), [python](#recipe_modules-python), [step](#recipe_modules-step)

&mdash; **def [RunSteps](/recipe_modules/futures/examples/lazy_fan_out_in_early_abort.py#12)(api):**
### *recipes* / [futures:examples/result](/recipe_modules/futures/examples/result.py)

[DEPS](/recipe_modules/futures/examples/result.py#5): [futures](#recipe_modules-futures), [step](#recipe_modules-step)

&mdash; **def [RunSteps](/recipe_modules/futures/examples/result.py#11)(api):**
### *recipes* / [generator\_script:examples/full](/recipe_modules/generator_script/examples/full.py)

[DEPS](/recipe_modules/generator_script/examples/full.py#7): [generator\_script](#recipe_modules-generator_script), [json](#recipe_modules-json), [path](#recipe_modules-path), [properties](#recipe_modules-properties), [step](#recipe_modules-step)

&mdash; **def [RunSteps](/recipe_modules/generator_script/examples/full.py#19)(api, script_name):**
### *recipes* / [isolated:examples/full](/recipe_modules/isolated/examples/full.py)

[DEPS](/recipe_modules/isolated/examples/full.py#5): [file](#recipe_modules-file), [isolated](#recipe_modules-isolated), [json](#recipe_modules-json), [path](#recipe_modules-path), [runtime](#recipe_modules-runtime), [step](#recipe_modules-step)

&mdash; **def [RunSteps](/recipe_modules/isolated/examples/full.py#15)(api):**
### *recipes* / [json:examples/full](/recipe_modules/json/examples/full.py)

[DEPS](/recipe_modules/json/examples/full.py#5): [json](#recipe_modules-json), [path](#recipe_modules-path), [properties](#recipe_modules-properties), [python](#recipe_modules-python), [raw\_io](#recipe_modules-raw_io), [step](#recipe_modules-step)

&mdash; **def [RunSteps](/recipe_modules/json/examples/full.py#16)(api):**
### *recipes* / [json:tests/add\_json\_log](/recipe_modules/json/tests/add_json_log.py)

[DEPS](/recipe_modules/json/tests/add_json_log.py#5): [json](#recipe_modules-json), [step](#recipe_modules-step)

&mdash; **def [RunSteps](/recipe_modules/json/tests/add_json_log.py#10)(api):**
### *recipes* / [led:tests/full](/recipe_modules/led/tests/full.py)

[DEPS](/recipe_modules/led/tests/full.py#5): [json](#recipe_modules-json), [led](#recipe_modules-led), [step](#recipe_modules-step)

&mdash; **def [RunSteps](/recipe_modules/led/tests/full.py#12)(api):**
### *recipes* / [path:examples/full](/recipe_modules/path/examples/full.py)

[DEPS](/recipe_modules/path/examples/full.py#5): [path](#recipe_modules-path), [platform](#recipe_modules-platform), [properties](#recipe_modules-properties), [step](#recipe_modules-step)

&mdash; **def [RunSteps](/recipe_modules/path/examples/full.py#14)(api):**
### *recipes* / [platform:examples/full](/recipe_modules/platform/examples/full.py)

[DEPS](/recipe_modules/platform/examples/full.py#5): [platform](#recipe_modules-platform), [step](#recipe_modules-step)

&mdash; **def [RunSteps](/recipe_modules/platform/examples/full.py#10)(api):**
### *recipes* / [properties:examples/full](/recipe_modules/properties/examples/full.py)

[DEPS](/recipe_modules/properties/examples/full.py#10): [properties](#recipe_modules-properties), [step](#recipe_modules-step)

&mdash; **def [RunSteps](/recipe_modules/properties/examples/full.py#18)(api, props, env_props):**
### *recipes* / [python:examples/full](/recipe_modules/python/examples/full.py)

[DEPS](/recipe_modules/python/examples/full.py#7): [path](#recipe_modules-path), [python](#recipe_modules-python), [raw\_io](#recipe_modules-raw_io), [step](#recipe_modules-step)

Launches the repo bundler.

&mdash; **def [RunSteps](/recipe_modules/python/examples/full.py#15)(api):**
### *recipes* / [python:tests/infra\_failing\_step](/recipe_modules/python/tests/infra_failing_step.py)

[DEPS](/recipe_modules/python/tests/infra_failing_step.py#9): [python](#recipe_modules-python), [step](#recipe_modules-step)

Tests for api.python.infra_failing_step.

&mdash; **def [RunSteps](/recipe_modules/python/tests/infra_failing_step.py#15)(api):**
### *recipes* / [random:tests/full](/recipe_modules/random/tests/full.py)

[DEPS](/recipe_modules/random/tests/full.py#5): [random](#recipe_modules-random), [step](#recipe_modules-step)

&mdash; **def [RunSteps](/recipe_modules/random/tests/full.py#11)(api):**
### *recipes* / [raw\_io:examples/full](/recipe_modules/raw_io/examples/full.py)

[DEPS](/recipe_modules/raw_io/examples/full.py#5): [path](#recipe_modules-path), [properties](#recipe_modules-properties), [python](#recipe_modules-python), [raw\_io](#recipe_modules-raw_io), [step](#recipe_modules-step)

&mdash; **def [RunSteps](/recipe_modules/raw_io/examples/full.py#14)(api):**
### *recipes* / [runtime:tests/full](/recipe_modules/runtime/tests/full.py)

[DEPS](/recipe_modules/runtime/tests/full.py#7): [runtime](#recipe_modules-runtime), [step](#recipe_modules-step)

&mdash; **def [RunSteps](/recipe_modules/runtime/tests/full.py#13)(api):**
### *recipes* / [scheduler:examples/emit\_triggers](/recipe_modules/scheduler/examples/emit_triggers.py)

[DEPS](/recipe_modules/scheduler/examples/emit_triggers.py#7): [json](#recipe_modules-json), [properties](#recipe_modules-properties), [runtime](#recipe_modules-runtime), [scheduler](#recipe_modules-scheduler), [time](#recipe_modules-time)

This file is a recipe demonstrating emitting triggers to LUCI Scheduler.

&mdash; **def [RunSteps](/recipe_modules/scheduler/examples/emit_triggers.py#16)(api):**
### *recipes* / [scheduler:examples/host](/recipe_modules/scheduler/examples/host.py)

[DEPS](/recipe_modules/scheduler/examples/host.py#7): [scheduler](#recipe_modules-scheduler), [step](#recipe_modules-step)

This file is a recipe demonstrating reading/mocking scheduler host.

&mdash; **def [RunSteps](/recipe_modules/scheduler/examples/host.py#12)(api):**
### *recipes* / [scheduler:examples/triggers](/recipe_modules/scheduler/examples/triggers.py)

[DEPS](/recipe_modules/scheduler/examples/triggers.py#14): [scheduler](#recipe_modules-scheduler), [step](#recipe_modules-step)

This file is a recipe demonstrating reading triggers of the current build.

&mdash; **def [RunSteps](/recipe_modules/scheduler/examples/triggers.py#19)(api):**
### *recipes* / [service\_account:examples/full](/recipe_modules/service_account/examples/full.py)

[DEPS](/recipe_modules/service_account/examples/full.py#7): [path](#recipe_modules-path), [platform](#recipe_modules-platform), [properties](#recipe_modules-properties), [raw\_io](#recipe_modules-raw_io), [service\_account](#recipe_modules-service_account)

&mdash; **def [RunSteps](/recipe_modules/service_account/examples/full.py#21)(api, key_path, scopes):**
### *recipes* / [source\_manifest:examples/simple](/recipe_modules/source_manifest/examples/simple.py)

[DEPS](/recipe_modules/source_manifest/examples/simple.py#6): [python](#recipe_modules-python), [source\_manifest](#recipe_modules-source_manifest)

&mdash; **def [RunSteps](/recipe_modules/source_manifest/examples/simple.py#12)(api):**
### *recipes* / [step:examples/full](/recipe_modules/step/examples/full.py)

[DEPS](/recipe_modules/step/examples/full.py#7): [context](#recipe_modules-context), [json](#recipe_modules-json), [path](#recipe_modules-path), [properties](#recipe_modules-properties), [step](#recipe_modules-step)

&mdash; **def [RunSteps](/recipe_modules/step/examples/full.py#25)(api, bad_return, access_invalid_data, access_deep_invalid_data, assign_extra_junk, timeout):**
### *recipes* / [step:tests/active\_result](/recipe_modules/step/tests/active_result.py)

[DEPS](/recipe_modules/step/tests/active_result.py#5): [step](#recipe_modules-step)

&mdash; **def [RunSteps](/recipe_modules/step/tests/active_result.py#10)(api):**
### *recipes* / [step:tests/defer](/recipe_modules/step/tests/defer.py)

[DEPS](/recipe_modules/step/tests/defer.py#5): [step](#recipe_modules-step)

&mdash; **def [RunSteps](/recipe_modules/step/tests/defer.py#9)(api):**
### *recipes* / [step:tests/inject\_paths](/recipe_modules/step/tests/inject_paths.py)

[DEPS](/recipe_modules/step/tests/inject_paths.py#5): [context](#recipe_modules-context), [path](#recipe_modules-path), [properties](#recipe_modules-properties), [step](#recipe_modules-step)

&mdash; **def [RunSteps](/recipe_modules/step/tests/inject_paths.py#13)(api):**
### *recipes* / [step:tests/nested](/recipe_modules/step/tests/nested.py)

[DEPS](/recipe_modules/step/tests/nested.py#8): [context](#recipe_modules-context), [step](#recipe_modules-step)

&mdash; **def [RunSteps](/recipe_modules/step/tests/nested.py#14)(api):**
### *recipes* / [step:tests/stdio](/recipe_modules/step/tests/stdio.py)

[DEPS](/recipe_modules/step/tests/stdio.py#5): [raw\_io](#recipe_modules-raw_io), [step](#recipe_modules-step)

&mdash; **def [RunSteps](/recipe_modules/step/tests/stdio.py#11)(api):**
### *recipes* / [step:tests/step\_call\_args](/recipe_modules/step/tests/step_call_args.py)

[DEPS](/recipe_modules/step/tests/step_call_args.py#5): [step](#recipe_modules-step)

&mdash; **def [RunSteps](/recipe_modules/step/tests/step_call_args.py#10)(api):**
### *recipes* / [step:tests/subannotations](/recipe_modules/step/tests/subannotations.py)

[DEPS](/recipe_modules/step/tests/subannotations.py#5): [step](#recipe_modules-step)

&mdash; **def [RunSteps](/recipe_modules/step/tests/subannotations.py#7)(api):**
### *recipes* / [step:tests/timeout](/recipe_modules/step/tests/timeout.py)

[DEPS](/recipe_modules/step/tests/timeout.py#8): [properties](#recipe_modules-properties), [step](#recipe_modules-step)

&mdash; **def [RunSteps](/recipe_modules/step/tests/timeout.py#19)(api, timeout):**
### *recipes* / [step:tests/trigger](/recipe_modules/step/tests/trigger.py)

[DEPS](/recipe_modules/step/tests/trigger.py#7): [properties](#recipe_modules-properties), [step](#recipe_modules-step)

&mdash; **def [RunSteps](/recipe_modules/step/tests/trigger.py#16)(api, command):**
### *recipes* / [swarming:examples/full](/recipe_modules/swarming/examples/full.py)

[DEPS](/recipe_modules/swarming/examples/full.py#8): [cipd](#recipe_modules-cipd), [path](#recipe_modules-path), [runtime](#recipe_modules-runtime), [step](#recipe_modules-step), [swarming](#recipe_modules-swarming)

&mdash; **def [RunSteps](/recipe_modules/swarming/examples/full.py#17)(api):**
### *recipes* / [tempfile:examples/full](/recipe_modules/tempfile/examples/full.py)

[DEPS](/recipe_modules/tempfile/examples/full.py#5): [tempfile](#recipe_modules-tempfile)

&mdash; **def [RunSteps](/recipe_modules/tempfile/examples/full.py#9)(api):**
### *recipes* / [time:examples/full](/recipe_modules/time/examples/full.py)

[DEPS](/recipe_modules/time/examples/full.py#7): [step](#recipe_modules-step), [time](#recipe_modules-time)

&mdash; **def [RunSteps](/recipe_modules/time/examples/full.py#13)(api):**
### *recipes* / [tricium:examples/full](/recipe_modules/tricium/examples/full.py)

[DEPS](/recipe_modules/tricium/examples/full.py#5): [properties](#recipe_modules-properties), [tricium](#recipe_modules-tricium)

&mdash; **def [RunSteps](/recipe_modules/tricium/examples/full.py#11)(api):**
### *recipes* / [url:examples/full](/recipe_modules/url/examples/full.py)

[DEPS](/recipe_modules/url/examples/full.py#5): [context](#recipe_modules-context), [path](#recipe_modules-path), [step](#recipe_modules-step), [url](#recipe_modules-url)

&mdash; **def [RunSteps](/recipe_modules/url/examples/full.py#27)(api):**
### *recipes* / [url:tests/join](/recipe_modules/url/tests/join.py)

[DEPS](/recipe_modules/url/tests/join.py#5): [step](#recipe_modules-step), [url](#recipe_modules-url)

&mdash; **def [RunSteps](/recipe_modules/url/tests/join.py#11)(api):**
### *recipes* / [url:tests/validate\_url](/recipe_modules/url/tests/validate_url.py)

[DEPS](/recipe_modules/url/tests/validate_url.py#5): [properties](#recipe_modules-properties), [step](#recipe_modules-step), [url](#recipe_modules-url)

&mdash; **def [RunSteps](/recipe_modules/url/tests/validate_url.py#12)(api):**
### *recipes* / [uuid:examples/full](/recipe_modules/uuid/examples/full.py)

[DEPS](/recipe_modules/uuid/examples/full.py#5): [step](#recipe_modules-step), [uuid](#recipe_modules-uuid)

&mdash; **def [RunSteps](/recipe_modules/uuid/examples/full.py#11)(api):**

